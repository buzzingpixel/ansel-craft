{# @var \buzzingpixel\ansel\models\AnselFieldSettingsModel settings #}
{# @var \buzzingpixel\ansel\models\AnselImageModel image #}

{% set image = image|default(null) %}

{% set id = anselUniqueId() %}
{% set fieldName = settings.fieldName %}

{% set src = false %}

{% if image and image.cacheFile %}
    {% set src = image.getBase64FromCacheFile() %}
{% elseif image and image.getOriginalAsset() %}
    {% set src = image.getOriginalAsset().getUrl() %}
{% endif %}

{% import 'ansel/_macros/Macros.twig' as m %}

<div
    class="AnselField__Image JSAnselField__Image"
    data-id="{{ id }}"
    {% if image %}
    data-original-asset-id="{{ image.originalAssetId }}"
    {% endif %}
>
    {% if image %}
        <input
            type="hidden"
            name="{{ m.fieldName(fieldName, id, 'assetId') }}"
            class="JSAnselField__Input JSAnselField__Input--AssetId"
            value="{{ image.assetId }}"
        >
        <input
            type="hidden"
            name="{{ m.fieldName(fieldName, id, 'highQualAssetId') }}"
            class="JSAnselField__Input JSAnselField__Input--HighQualAssetId"
            value="{{ image.highQualAssetId }}"
        >
        <input
            type="hidden"
            name="{{ m.fieldName(fieldName, id, 'thumbAssetId') }}"
            class="JSAnselField__Input JSAnselField__Input--ThumbAssetId"
            value="{{ image.thumbAssetId }}"
        >
        <input
            type="hidden"
            name="{{ m.fieldName(fieldName, id, 'thumbAssetId') }}"
            class="JSAnselField__Input JSAnselField__Input--ThumbAssetId"
            value="{{ image.thumbAssetId }}"
        >
    {% endif %}

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'title') }}"
        class="JSAnselField__Input JSAnselField__Input--Title"
        {% if image %}
        value="{{ image.title }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'caption') }}"
        class="JSAnselField__Input JSAnselField__Input--Caption"
        {% if image %}
        value="{{ image.caption }}"
        {% endif %}
    >

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'id') }}"
        class="JSAnselField__Input JSAnselField__Input--Id"
        {% if image %}
        value="{{ image.id }}"
        {% endif %}
    >

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'delete') }}"
        class="JSAnselField__Input JSAnselField__Input--Delete"
    >

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'originalAssetId') }}"
        class="JSAnselField__Input JSAnselField__Input--OriginalAssetId"
        {% if image %}
        value="{{ image.originalAssetId }}"
        {% endif %}
    >

    <input type="hidden" name="{{ m.fieldName(fieldName, id, 'cover') }}" value="0" class="JSAnselField__Input">
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'cover') }}"
        class="JSAnselField__Input JSAnselField__Input--Cover"
        {% if image and image.cover %}
        value="1"
        {% endif %}
    >

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'x') }}"
        class="JSAnselField__Input JSAnselField__Input--X"
        {% if image %}
        value="{{ image.x }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'y') }}"
        class="JSAnselField__Input JSAnselField__Input--Y"
        {% if image %}
        value="{{ image.y }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'width') }}"
        class="JSAnselField__Input JSAnselField__Input--Width"
        {% if image %}
        value="{{ image.width }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'height') }}"
        class="JSAnselField__Input JSAnselField__Input--Height"
        {% if image %}
        value="{{ image.height }}"
        {% endif %}
    >

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'cacheFile') }}"
        class="JSAnselField__Input JSAnselField__Input--CacheFile"
        {% if image and image.cacheFile %}
        value="{{ image.cacheFile }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'fileName') }}"
        class="JSAnselField__Input JSAnselField__Input--FileName"
        {% if image and image.fileName %}
        value="{{ image.fileName }}"
        {% endif %}
    >

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'fileLocation') }}"
        class="JSAnselField__Input JSAnselField__Input--PreFileLocation"
        {% if image and image.getFromPreManipulationArray('fileLocation') %}
        value="{{ image.getFromPreManipulationArray('fileLocation') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'fileLocationType') }}"
        class="JSAnselField__Input JSAnselField__Input--PreFileLocationType"
        {% if image and image.getFromPreManipulationArray('fileLocationType') %}
        value="{{ image.getFromPreManipulationArray('fileLocationType') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'h') }}"
        class="JSAnselField__Input JSAnselField__Input--PreH"
        {% if image and image.getFromPreManipulationArray('h') %}
        value="{{ image.getFromPreManipulationArray('h') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'w') }}"
        class="JSAnselField__Input JSAnselField__Input--PreW"
        {% if image and image.getFromPreManipulationArray('w') %}
        value="{{ image.getFromPreManipulationArray('w') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'x') }}"
        class="JSAnselField__Input JSAnselField__Input--PreX"
        {% if image and image.getFromPreManipulationArray('x') %}
        value="{{ image.getFromPreManipulationArray('x') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'y') }}"
        class="JSAnselField__Input JSAnselField__Input--PreY"
        {% if image and image.getFromPreManipulationArray('y') %}
        value="{{ image.getFromPreManipulationArray('y') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'highQualityImgCacheLocation') }}"
        class="JSAnselField__Input JSAnselField__Input--PreHighQualityImgCacheLocation"
        {% if image and image.getFromPreManipulationArray('highQualityImgCacheLocation') %}
        value="{{ image.getFromPreManipulationArray('highQualityImgCacheLocation') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'standardImgCacheLocation') }}"
        class="JSAnselField__Input JSAnselField__Input--PreStandardImgCacheLocation"
        {% if image and image.getFromPreManipulationArray('standardImgCacheLocation') %}
        value="{{ image.getFromPreManipulationArray('standardImgCacheLocation') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'thumbImgCacheLocation') }}"
        class="JSAnselField__Input JSAnselField__Input--PreThumbImgCacheLocation"
        {% if image and image.getFromPreManipulationArray('thumbImgCacheLocation') %}
        value="{{ image.getFromPreManipulationArray('thumbImgCacheLocation') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'maxHeight') }}"
        class="JSAnselField__Input JSAnselField__Input--PreMaxHeight"
        {% if image and image.getFromPreManipulationArray('maxHeight') %}
        value="{{ image.getFromPreManipulationArray('maxHeight') }}"
        {% endif %}
    >
    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'preManipulation', 'maxWidth') }}"
        class="JSAnselField__Input JSAnselField__Input--PreMaxWidth"
        {% if image and image.getFromPreManipulationArray('maxWidth') %}
        value="{{ image.getFromPreManipulationArray('maxWidth') }}"
        {% endif %}
    >

    {% set asset = null %}
    {% if image %}
        {% set asset = image.getAsset() %}
    {% endif %}
    {% set focalPoint = null %}
    {% if asset %}
        {% set focalPoint = asset.getFocalPoint() %}
    {% endif %}

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'focalX') }}"
        class="JSAnselField__Input JSAnselField__Input--FocalX"
        {% if focalPoint and focalPoint['x'] is defined %}
        value="{{ focalPoint.x }}"
        {% else %}
        value="0.5"
        {% endif %}
    >

    <input
        type="hidden"
        name="{{ m.fieldName(fieldName, id, 'focalY') }}"
        class="JSAnselField__Input JSAnselField__Input--FocalY"
        {% if focalPoint and focalPoint['y'] is defined %}
        value="{{ focalPoint.y }}"
        {% else %}
        value="0.5"
        {% endif %}
    >

    <div class="AnselField__ImageIcons">
        <div class="AnselField__ImageIconsInner">
            {% if settings.hasModalFields() %}
                <div class="AnselField__ImageIcon AnselField__ImageIconEdit JSAnselField__ImageIconEdit" title="{{ 'Edit Fields'|t }}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="16px" height="14px"><path fill="currentColor" d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z" class=""></path></svg>
                </div>
            {% endif %}
            <div class="AnselField__ImageIcon AnselField__ImageIconCrop JSAnselField__ImageIconCrop" title="{{ 'Crop Image'|t }}">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16px" height="16px"><path fill="currentColor" d="M488 352h-40V109.3l57-57c9.4-9.4 9.4-24.6 0-33.9L493.7 7c-9.4-9.4-24.6-9.4-33.9 0l-57 57H160V24c0-13.3-10.7-24-24-24H88C74.7 0 64 10.7 64 24v40H24C10.7 64 0 74.7 0 88v48c0 13.3 10.7 24 24 24h40v264c0 13.3 10.7 24 24 24h264v40c0 13.3 10.7 24 24 24h48c13.3 0 24-10.7 24-24v-40h40c13.3 0 24-10.7 24-24v-48c0-13.3-10.7-24-24-24zM306.7 160L160 306.7V160h146.7zM205.3 352L352 205.3V352H205.3z" class=""></path></svg>
            </div>
            <div class="AnselField__ImageIcon AnselField__ImageIconFocalPoint JSAnselField__ImageIconFocalPoint" title="{{ 'Set Focal Point'|t }}">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="5 5 14 14" width="16px" height="16px"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="focal-point" fill="currentColor"><g transform="translate(5.000000, 5.000000)"><g><path d="M7,14 C10.8659932,14 14,10.8659932 14,7 C14,3.13400675 10.8659932,0 7,0 C3.13400675,0 0,3.13400675 0,7 C0,10.8659932 3.13400675,14 7,14 Z M7,12.6 C10.0927946,12.6 12.6,10.0927946 12.6,7 C12.6,3.9072054 10.0927946,1.4 7,1.4 C3.9072054,1.4 1.4,3.9072054 1.4,7 C1.4,10.0927946 3.9072054,12.6 7,12.6 Z" id="Combined-Shape"></path><circle id="Oval" cx="7" cy="7" r="2.1"></circle></g></g></g></g></svg>
            </div>
            <div class="AnselField__ImageIcon AnselField__ImageIconRemove JSAnselField__ImageIconRemove" title="{{ 'Remove Image'|t }}">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 64 384 384" width="16px" height="16px"><path fill="currentColor" d="M323.1 441l53.9-53.9c9.4-9.4 9.4-24.5 0-33.9L279.8 256l97.2-97.2c9.4-9.4 9.4-24.5 0-33.9L323.1 71c-9.4-9.4-24.5-9.4-33.9 0L192 168.2 94.8 71c-9.4-9.4-24.5-9.4-33.9 0L7 124.9c-9.4 9.4-9.4 24.5 0 33.9l97.2 97.2L7 353.2c-9.4 9.4-9.4 24.5 0 33.9L60.9 441c9.4 9.4 24.5 9.4 33.9 0l97.2-97.2 97.2 97.2c9.3 9.3 24.5 9.3 33.9 0z" class=""></path></svg>
            </div>
        </div>
    </div>
    <div class="AnselField__ImageWrapper">
        <div class="AnselField__ImageWrapperInner JSAnselField__ImageWrapperInner">
            <img{% if src %} src="{{ src }}"{% endif %} alt="" class="AnselField__ImageTag JSAnselField__ImageTag">
        </div>
    </div>
</div>
