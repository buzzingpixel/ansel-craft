function runFabController(e){"use strict";if(void 0!==window.jQuery){var o=window.jQuery,n={},t=[],i=function(t,i){var r;return"object"==typeof t?(i=t,t=null):"string"!=typeof t&&(i={},t=null),r=function(n){var t,r,a=this,l=$.extend(!0,{},i);for(t in l)l.hasOwnProperty(t)&&(a[t]=l[t]);if("object"==typeof n)for(t in n)n.hasOwnProperty(t)&&(a[t]=n[t]);if(a.el?"string"==typeof a.el?(a.$el=$(a.el),a.el=a.$el.get(0)):a.el instanceof o?(a.$el=a.el,a.el=a.$el.get(0)):a.el instanceof HTMLElement&&(a.$el=$(a.el)):(a.$el=$("<div></div>"),a.el=a.$el.get(0)),"object"==typeof a.model&&void 0!==e.model?e.model.validateGuid(a.model.guid)||(r=e.model.make(a.model),a.model=new r):void 0!==this.model&&(a.model=null),"function"==typeof a.init&&(Array.prototype.shift.apply(arguments),a.init.apply(a,arguments)),"object"==typeof a.events)for(t in a.events)a.events.hasOwnProperty(t)&&"function"==typeof a.events[t]&&function(e,o){e[1]?a.$el.on(e[0],e[1],function(){o.apply(a,arguments)}):a.$el.on(e[0],function(){o.apply(a,arguments)})}(t.split(" "),a.events[t])},t&&(n[t]=r),r};e.controller={make:function(){return i.apply(i,arguments)},construct:function(e){var o;return"function"!=typeof n[e]?null:(o=new(Function.prototype.bind.apply(n[e],arguments)),t.push(o),o)}}}else setTimeout(function(){runFabController(e)},10)}function runField(e){"use strict";var o,n;window.jQuery&&e.controller&&e.model?(o=e.model.make({dragStart:"int",dragEnd:"int",drop:"int",uploadStart:"int",uploadComplete:"int",notificationChange:"int",activeCover:"string",openFieldEditor:"string"}),n=e.model.make({uploadKey:"string",uploadActionUrl:"string",csrfToken:"string",elementId:"int",fieldId:"int",fieldName:"string",uploadLocation:"int",uploadFolderId:"int",saveLocation:"int",saveFolderId:"int",minQty:"int",maxQty:"int",preventUploadOverMax:"bool",quality:"int",forceJpg:"bool",retinaMode:"bool",minWidth:"int",minHeight:"int",maxWidth:"int",maxHeight:"int",ratio:"string",ratioWidth:"int",ratioHeight:"int",showTitle:"bool",requireTitle:"int",titleLabel:"string",showCaption:"bool",requireCaption:"bool",captionLabel:"string",showCover:"bool",requireCover:"bool",coverLabel:"string"}),e.controller.make("Field",{commonStorage:{el:null,$el:null,sharedModel:null,eventTriggers:null,sorter:null,imageTemplate:null,$imagesHolder:null,$notificationList:null},init:function(){var o;this.setUp(),o={commonStorage:this.commonStorage},e.controller.construct("Notifications",o),e.controller.construct("FieldDropUploader",o)},setUp:function(){var e=this,n=e.$el.find(".JSAnselField__ImageTemplate").html(),t=e.$el.find(".JSAnselField__ImagesHolder");e.commonStorage={el:e.el,$el:e.$el,sharedModel:e.populateSharedModel(),eventTriggers:new o,sorter:e.setUpSorting(t),imageTemplate:n,$imagesHolder:t,$notificationList:e.$el.find(".JSAnselField__Notifications"),fieldsModalHtml:e.$el.find(".JSAnselField__ModalTemplate").html()}},populateSharedModel:function(){var e=this.$el.data("settings"),o={uploadKey:this.$el.data("uploadKey"),uploadActionUrl:this.$el.data("uploadActionUrl"),csrfToken:this.$el.data("csrfToken")};for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return new n(o)},setUpSorting:function(e){return new window.Garnish.DragSort({container:e,axis:null,collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.6})}})):setTimeout(function(){runField(e)},10)}function runFieldDropUploader(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("FieldDropUploader",{commonStorage:{},uploadFiles:{},uploadInProgress:!1,init:function(){var o=this,n=o.commonStorage.$el;n.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){n.addClass("AnselField--DragInProgress"),o.commonStorage.eventTriggers.set("dragStart",o.commonStorage.eventTriggers.get("dragStart")+1)}).on("dragleave dragend drop",function(){n.removeClass("AnselField--DragInProgress"),o.commonStorage.eventTriggers.set("dragEnd",o.commonStorage.eventTriggers.get("dragEnd")+1)}).on("drop",function(t){var i=t.originalEvent.dataTransfer.files;n.addClass("AnselField--IsUploading"),o.commonStorage.eventTriggers.set("drop",o.commonStorage.eventTriggers.get("drop")+1),$.each(i,function(n,t){o.uploadFiles[e.uuid.make()]=t})}),o.processUploadFilesWatcher()},processUploadFilesWatcher:function(){var e=this;e.commonStorage.$el.hasClass("AnselField--IsUploading")&&!Object.keys(e.uploadFiles).length&&(e.commonStorage.$el.removeClass("AnselField--IsUploading"),e.commonStorage.eventTriggers.set("uploadComplete",e.commonStorage.eventTriggers.get("uploadComplete")+1)),!e.uploadInProgress&&Object.keys(e.uploadFiles).length?(e.commonStorage.eventTriggers.set("uploadStart",e.commonStorage.eventTriggers.get("uploadStart")+1),e.uploadInProgress=!0,e.processUploadFile(Object.keys(e.uploadFiles)[0]),setTimeout(function(){e.processUploadFilesWatcher()},500)):setTimeout(function(){e.processUploadFilesWatcher()},500)},processUploadFile:function(o){var n=this,t=n.uploadFiles[o],i=new FormData;i.append("CRAFT_CSRF_TOKEN",n.commonStorage.sharedModel.get("csrfToken")),i.append("uploadKey",n.commonStorage.sharedModel.get("uploadKey")),i.append("file",t,t.name),i.append("minWidth",n.commonStorage.sharedModel.get("minWidth")),i.append("minHeight",n.commonStorage.sharedModel.get("minHeight")),$.ajax({url:n.commonStorage.sharedModel.get("uploadActionUrl"),type:"post",data:i,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){delete n.uploadFiles[o],n.uploadInProgress=!1},success:function(o){o.success?e.controller.construct("Image",{commonStorage:n.commonStorage,base64Image:o.file.base64,cacheFile:o.file.cacheFile,fileName:t.name}):e.controller.construct("Notification",{commonStorage:n.commonStorage,error:!0,heading:t.name,message:o.message,destroyEvents:["dragStart"]})},error:function(){e.controller.construct("Notification",{commonStorage:n.commonStorage,error:!0,heading:t.name,message:"An unknown error occurred while uploading this file",destroyEvents:["dragStart"]})}})}}):setTimeout(function(){runFieldDropUploader(e)},10)}function runImage(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Image",{commonStorage:{},$image:null,$imageTag:null,$fieldsModal:null,base64Image:null,cacheFile:null,fileName:null,uuid:null,init:function(){var o=this;o.uuid=e.uuid.make(),o.$image=$(o.commonStorage.imageTemplate),o.$image.data("jsUuid",o.uuid),o.$imageTag=o.$image.find(".JSAnselField__ImageTag"),o.$imageTag.attr("src",o.base64Image),o.commonStorage.$imagesHolder.append(o.$image),o.commonStorage.sorter.addItems(o.$image),o.initFieldEditor(),o.watchOpenFieldEditor(),o.watchForCoverChange()},initFieldEditor:function(){var e=this;e.$image.find(".JSAnselField__ImageIconEdit").on("click",function(){e.$fieldsModal=$(e.commonStorage.fieldsModalHtml),e.openFieldEditor()})},openFieldEditor:function(){this.$fieldsModal=$(this.commonStorage.fieldsModalHtml),this._openFieldEditor()},_openFieldEditor:function(){var e=this,o=e.$fieldsModal.find(".AnselField__FieldsModalCancel"),n=e.$fieldsModal.find(".AnselField__FieldsModalSave"),t=e.$fieldsModal.find(".AnselField__FieldsModalPrev"),i=e.$fieldsModal.find(".AnselField__FieldsModalNext"),r=e.$fieldsModal.find(".JSAnselField__FieldsModalPreviewImageTag"),a=e.$fieldsModal.find(".JSAnselField__FieldsModalBodyHeading"),l=new window.Garnish.Modal(e.$fieldsModal),s=e.$fieldsModal.find(".JSAnselField__FieldsModalTitle"),d=e.$image.find(".JSAnselField__Input--Title"),c=e.$fieldsModal.find(".JSAnselField__FieldsModalCaption"),g=e.$image.find(".JSAnselField__Input--Caption"),p=e.$fieldsModal.find(".JSAnselField__FieldsModalCover").find(".lightswitch"),u=p.find(":input"),m=e.$image.find(".JSAnselField__Input--Cover"),f=e.$image.prev(".JSAnselField__Image"),w=e.$image.next(".JSAnselField__Image"),h=e.$fieldsModal.find(".AnselField__FieldsModalFooterSecondaryButtons");function v(){d.val(""),g.val(""),m.val(""),d.val(s.val()),g.val(c.val()),m.val(u.val()),u.val()&&e.commonStorage.eventTriggers.set("activeCover",e.uuid)}function S(){l&&(l.hide(),l.destroy(),l=null)}r.attr("src",e.$imageTag.attr("src")),a.text(e.fileName),e.$fieldsModal.find(".lightswitch").lightswitch(),s.val(d.val()),c.val(g.val()),m.val()&&p.trigger("mousedown").trigger("mouseup"),o.on("click",function(){S()}),n.on("click",function(){v(),S()}),f.length?t.on("click",function(){v(),l.hide(),e.commonStorage.eventTriggers.set("openFieldEditor",""),setTimeout(function(){S(),e.commonStorage.eventTriggers.set("openFieldEditor",f.data("jsUuid"))},50)}):t.addClass("disabled"),w.length?i.on("click",function(){v(),l.hide(),e.commonStorage.eventTriggers.set("openFieldEditor",""),setTimeout(function(){S(),e.commonStorage.eventTriggers.set("openFieldEditor",w.data("jsUuid"))},50)}):i.addClass("disabled"),f.length||w.length||h.hide()},watchOpenFieldEditor:function(){var e=this;e.commonStorage.eventTriggers.onChange("openFieldEditor",function(o){o===e.uuid&&setTimeout(function(){e.openFieldEditor()},50)})},watchForCoverChange:function(){var e=this;e.commonStorage.eventTriggers.onChange("activeCover",function(o){o!==e.uuid&&e.$image.find(".JSAnselField__Input--Cover").val("")})}}):setTimeout(function(){runImage(e)},10)}function runNotification(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Notification",{commonStorage:{},error:!1,heading:"",message:"",destroyEvents:[],$line:null,init:function(){var e=this,o="";e.$line=$('<li class="AnselField__Notification JSAnselField__Notification"></li>'),e.heading&&(o+="<strong>"+e.heading+"</strong>: "),o+=e.message,e.$line.html(o),e.error&&e.$line.addClass("AnselField__Notification--IsError"),e.$line.appendTo(e.commonStorage.$notificationList),e.commonStorage.eventTriggers.set("notificationChange",e.commonStorage.eventTriggers.get("notificationChange")+1),e.destroyEvents.forEach(function(o){e.commonStorage.eventTriggers.onChange(o+"."+e.uuid,function(){e.destroy()})})},destroy:function(){var e=this;e.$line.remove(),e.destroyEvents.forEach(function(o){e.commonStorage.eventTriggers.offChange(o+"."+e.uuid)}),e.commonStorage.eventTriggers.set("notificationChange",e.commonStorage.eventTriggers.get("notificationChange")+1)}}):setTimeout(function(){runNotification(e)},10)}function runNotifications(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Notifications",{commonStorage:{},$notifications:null,init:function(){var e=this;e.commonStorage.eventTriggers.onChange("notificationChange",function(){setTimeout(function(){e.triggerChange()},500)})},triggerChange:function(){var e=this.commonStorage.$notificationList;e.find(".JSAnselField__Notification").length?e.addClass("AnselField__Notifications--HasNotifications"):e.removeClass("AnselField__Notifications--HasNotifications")}}):setTimeout(function(){runNotifications(e)},10)}function runMain(e){"use strict";window.jQuery&&e.controller&&e.model?$(".JSAnselField").each(function(){e.controller.construct("Field",{el:this})}):setTimeout(function(){runMain(e)},10)}window.FABNAMESPACE="ANSEL",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},runFabController(window[window.FABNAMESPACE]),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";var o=[],n=function(e){var n;return"object"!=typeof e&&(e={}),(n=function(n){var t,i=this;for(var r in i.guid=(t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t(),o.push(i.guid),i.properties={},i.propertyTypes=e,i.changeEvents={},i.propertyTypes)i.propertyTypes.hasOwnProperty(r)&&(i.changeEvents[r]={});for(var a in n)n.hasOwnProperty(a)&&void 0!==i.propertyTypes[a]&&(i.properties[a]=n[a])}).prototype={get:function(e){var o=this;return o.properties[e]?"int"===o.propertyTypes[e]?parseInt(o.properties[e]):"float"===o.propertyTypes[e]?parseFloat(o.properties[e]):"string"===o.propertyTypes[e]?String(o.properties[e]):"bool"===o.propertyTypes[e]?!0===o.properties[e]:"array"===o.propertyTypes[e]?o.properties[e].constructor===Array?o.properties[e]:[]:"object"===o.propertyTypes[e]?o.properties[e].constructor===Object?o.properties[e]:{}:null:"int"===o.propertyTypes[e]||"float"===o.propertyTypes[e]?0:"string"===o.propertyTypes[e]?"":"bool"!==o.propertyTypes[e]&&("array"===o.propertyTypes[e]?[]:"object"===o.propertyTypes[e]?{}:null)},set:function(e,o){var n,t=this,i=!1,r=t.properties[e];if("int"===t.propertyTypes[e]?(t.properties[e]=parseInt(o),i=!0):"float"===t.propertyTypes[e]?(t.properties[e]=parseFloat(o),i=!0):"string"===t.propertyTypes[e]?(t.properties[e]=String(o),i=!0):"bool"===t.propertyTypes[e]?(t.properties[e]=!0===o||"true"===o||"yes"===o||"y"===o,i=!0):"array"===t.propertyTypes[e]?o.constructor===Array&&(t.properties[e]=o,i=!0):"object"===t.propertyTypes[e]&&o.constructor===Object&&(t.properties[e]=o,i=!0),i&&r!==t.properties[e]&&void 0!==t.changeEvents[e])for(var a in n=[t.properties[e],r],t.changeEvents[e])t.changeEvents[e][a].forEach(function(e){e.apply(e,n)})},onChange:function(e,o){var n=this,t=e.split(".");void 0!==n.propertyTypes[t[0]]&&(void 0===t[1]?(void 0===n.changeEvents[t[0]].noNameSpace&&(n.changeEvents[t[0]].noNameSpace=[]),n.changeEvents[t[0]].noNameSpace.push(o)):(void 0===n.changeEvents[t[0]][t[1]]&&(n.changeEvents[t[0]][t[1]]=[]),n.changeEvents[t[0]][t[1]].push(o)))},offChange:function(e){var o=e.split(".");void 0===o[1]?this.changeEvents[o[0]]={}:delete this.changeEvents[o[0]][o[1]]}},n};e.model={make:function(){return n.apply(n,arguments)},validateGuid:function(e){return o.indexOf(e)>-1}}}(window[window.FABNAMESPACE]),window.ANSEL=window.ANSEL||{},runField(window.ANSEL),window.ANSEL=window.ANSEL||{},runFieldDropUploader(window.ANSEL),window.ANSEL=window.ANSEL||{},runImage(window.ANSEL),window.ANSEL=window.ANSEL||{},runNotification(window.ANSEL),window.ANSEL=window.ANSEL||{},runNotifications(window.ANSEL),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";window[window.FABNAMESPACE].uuid={make:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}}(),window.ANSEL=window.ANSEL||{},runMain(window.ANSEL);
//# sourceMappingURL=script.min.js.map