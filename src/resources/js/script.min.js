function runFabController(e){"use strict";if(void 0!==window.jQuery){var t=window.jQuery,n={},i=[],o=function(i,o){var r;return"object"==typeof i?(o=i,i=null):"string"!=typeof i&&(o={},i=null),r=function(n){var i,r,s=this,a=$.extend(!0,{},o);for(i in a)a.hasOwnProperty(i)&&(s[i]=a[i]);if("object"==typeof n)for(i in n)n.hasOwnProperty(i)&&(s[i]=n[i]);if(s.el?"string"==typeof s.el?(s.$el=$(s.el),s.el=s.$el.get(0)):s.el instanceof t?(s.$el=s.el,s.el=s.$el.get(0)):s.el instanceof HTMLElement&&(s.$el=$(s.el)):(s.$el=$("<div></div>"),s.el=s.$el.get(0)),"object"==typeof s.model&&void 0!==e.model?e.model.validateGuid(s.model.guid)||(r=e.model.make(s.model),s.model=new r):void 0!==this.model&&(s.model=null),"function"==typeof s.init&&(Array.prototype.shift.apply(arguments),s.init.apply(s,arguments)),"object"==typeof s.events)for(i in s.events)s.events.hasOwnProperty(i)&&"function"==typeof s.events[i]&&function(e,t){e[1]?s.$el.on(e[0],e[1],function(){t.apply(s,arguments)}):s.$el.on(e[0],function(){t.apply(s,arguments)})}(i.split(" "),s.events[i])},i&&(n[i]=r),r};e.controller={make:function(){return o.apply(o,arguments)},construct:function(e){var t;return"function"!=typeof n[e]?null:(t=new(Function.prototype.bind.apply(n[e],arguments)),i.push(t),t)}}}else setTimeout(function(){runFabController(e)},10)}function runField(e){"use strict";var t,n;window.jQuery&&e.controller&&e.model?(t=e.model.make({dragStart:"int",dragEnd:"int",drop:"int",uploadStart:"int",uploadComplete:"int",notificationChange:"int",activeCover:"string",openFieldEditor:"string",orderChange:"int",imageControllerUuids:"array"}),n=e.model.make({uploadKey:"string",uploadActionUrl:"string",csrfToken:"string",elementId:"int",fieldId:"int",fieldName:"string",uploadLocation:"int",uploadFolderId:"int",saveLocation:"int",saveFolderId:"int",minQty:"int",maxQty:"int",preventUploadOverMax:"bool",quality:"int",forceJpg:"bool",retinaMode:"bool",minWidth:"int",minHeight:"int",maxWidth:"int",maxHeight:"int",ratio:"string",ratioWidth:"int",ratioHeight:"int",showTitle:"bool",requireTitle:"int",titleLabel:"string",showCaption:"bool",requireCaption:"bool",captionLabel:"string",showCover:"bool",requireCover:"bool",coverLabel:"string"}),e.controller.make("Field",{commonStorage:{el:null,$el:null,sharedModel:null,eventTriggers:null,sorter:null,imageTemplate:null,$imagesHolder:null,$notificationList:null},init:function(){var t;this.setUp(),t={commonStorage:this.commonStorage},e.controller.construct("Notifications",t),e.controller.construct("FieldDropUploader",t),e.controller.construct("MaxTracker",t),e.controller.construct("MinTracker",t)},setUp:function(){var e=this,n=e.$el.find(".JSAnselField__ImageTemplate").html(),i=e.$el.find(".JSAnselField__ImagesHolder");e.commonStorage={el:e.el,$el:e.$el,sharedModel:e.populateSharedModel(),eventTriggers:new t,sorter:e.setUpSorting(i),imageTemplate:n,$imagesHolder:i,$notificationList:e.$el.find(".JSAnselField__Notifications"),fieldsModalHtml:e.$el.find(".JSAnselField__ModalTemplate").html()}},populateSharedModel:function(){var e=this.$el.data("settings"),t={uploadKey:this.$el.data("uploadKey"),uploadActionUrl:this.$el.data("uploadActionUrl"),csrfToken:this.$el.data("csrfToken")};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return new n(t)},setUpSorting:function(e){var t=this;return new window.Garnish.DragSort({container:e,axis:null,collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.6,onSortChange:function(){t.commonStorage.eventTriggers.set("orderChange",t.commonStorage.eventTriggers.get("orderChange")+1)},onDragStop:function(){t.commonStorage.eventTriggers.set("orderChange",t.commonStorage.eventTriggers.get("orderChange")+1)}})}})):setTimeout(function(){runField(e)},10)}function runFieldDropUploader(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("FieldDropUploader",{commonStorage:{},uploadFiles:{},uploadInProgress:!1,init:function(){var t=this,n=t.commonStorage.$el;n.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){n.addClass("AnselField--DragInProgress"),t.commonStorage.eventTriggers.set("dragStart",t.commonStorage.eventTriggers.get("dragStart")+1)}).on("dragleave dragend drop",function(){n.removeClass("AnselField--DragInProgress"),t.commonStorage.eventTriggers.set("dragEnd",t.commonStorage.eventTriggers.get("dragEnd")+1)}).on("drop",function(i){var o=i.originalEvent.dataTransfer.files;n.addClass("AnselField--IsUploading"),t.commonStorage.eventTriggers.set("drop",t.commonStorage.eventTriggers.get("drop")+1),$.each(o,function(n,i){t.uploadFiles[e.uuid.make()]=i})}),t.processUploadFilesWatcher()},processUploadFilesWatcher:function(){var t=this,n=t.commonStorage.sharedModel.get("maxQty"),i=n>1?"images":"image",o=t.commonStorage.eventTriggers.get("imageControllerUuids").length;t.commonStorage.$el.hasClass("AnselField--IsUploading")&&!Object.keys(t.uploadFiles).length&&(t.commonStorage.$el.removeClass("AnselField--IsUploading"),t.commonStorage.eventTriggers.set("uploadComplete",t.commonStorage.eventTriggers.get("uploadComplete")+1)),Object.keys(t.uploadFiles).length&&t.commonStorage.sharedModel.get("preventUploadOverMax")&&o>=n&&(e.controller.construct("Notification",{commonStorage:t.commonStorage,message:"This field is limited to "+n+" "+i+" and does not allow image uploads beyond that quantity",destroyEvents:["dragStart","imageControllerUuids"]}),t.uploadFiles={}),!t.uploadInProgress&&Object.keys(t.uploadFiles).length?(t.commonStorage.eventTriggers.set("uploadStart",t.commonStorage.eventTriggers.get("uploadStart")+1),t.uploadInProgress=!0,t.processUploadFile(Object.keys(t.uploadFiles)[0]),setTimeout(function(){t.processUploadFilesWatcher()},500)):setTimeout(function(){t.processUploadFilesWatcher()},500)},processUploadFile:function(t){var n=this,i=n.uploadFiles[t],o=new FormData;o.append("CRAFT_CSRF_TOKEN",n.commonStorage.sharedModel.get("csrfToken")),o.append("uploadKey",n.commonStorage.sharedModel.get("uploadKey")),o.append("file",i,i.name),o.append("minWidth",n.commonStorage.sharedModel.get("minWidth")),o.append("minHeight",n.commonStorage.sharedModel.get("minHeight")),$.ajax({url:n.commonStorage.sharedModel.get("uploadActionUrl"),type:"post",data:o,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){delete n.uploadFiles[t],n.uploadInProgress=!1},success:function(t){t.success?e.controller.construct("Image",{commonStorage:n.commonStorage,base64Image:t.file.base64,cacheFile:t.file.cacheFile,fileName:i.name}):e.controller.construct("Notification",{commonStorage:n.commonStorage,error:!0,heading:i.name,message:t.message,destroyEvents:["dragStart"]})},error:function(){e.controller.construct("Notification",{commonStorage:n.commonStorage,error:!0,heading:i.name,message:"An unknown error occurred while uploading this file",destroyEvents:["dragStart"]})}})}}):setTimeout(function(){runFieldDropUploader(e)},10)}function runImage(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Image",{commonStorage:{},$image:null,$imageTag:null,$fieldsModal:null,base64Image:null,cacheFile:null,fileName:null,uuid:null,model:{isOverAllowed:"bool"},init:function(){var e=this;e.setUp(),e.initFieldEditor(),e.watchOpenFieldEditor(),e.watchForCoverChange(),e.watchForOrderChange(),e.watchForRemove()},setUp:function(){var t=this,n=t.commonStorage.eventTriggers.get("imageControllerUuids").slice(0);t.uuid=e.uuid.make(),n.push(t.uuid),t.commonStorage.eventTriggers.set("imageControllerUuids",n),t.$image=$(t.commonStorage.imageTemplate),t.$image.data("jsUuid",t.uuid),t.$imageTag=t.$image.find(".JSAnselField__ImageTag"),t.$imageTag.attr("src",t.base64Image),t.commonStorage.$imagesHolder.append(t.$image),t.commonStorage.sorter.addItems(t.$image),t.base64Image=null},initFieldEditor:function(){var e=this;e.$image.find(".JSAnselField__ImageIconEdit").on("click."+e.uuid,function(){e.$fieldsModal=$(e.commonStorage.fieldsModalHtml),e.openFieldEditor()})},openFieldEditor:function(){this.$fieldsModal=$(this.commonStorage.fieldsModalHtml),this._openFieldEditor()},_openFieldEditor:function(){var e=this,t=e.$fieldsModal.find(".AnselField__FieldsModalCancel"),n=e.$fieldsModal.find(".AnselField__FieldsModalSave"),i=e.$fieldsModal.find(".AnselField__FieldsModalPrev"),o=e.$fieldsModal.find(".AnselField__FieldsModalNext"),r=e.$fieldsModal.find(".JSAnselField__FieldsModalPreviewImageTag"),s=e.$fieldsModal.find(".JSAnselField__FieldsModalBodyHeading"),a=new window.Garnish.Modal(e.$fieldsModal),c=e.$fieldsModal.find(".JSAnselField__FieldsModalTitle"),l=e.$image.find(".JSAnselField__Input--Title"),h=e.$fieldsModal.find(".JSAnselField__FieldsModalCaption"),u=e.$image.find(".JSAnselField__Input--Caption"),d=e.$fieldsModal.find(".JSAnselField__FieldsModalCover").find(".lightswitch"),p=d.find(":input"),g=e.$image.find(".JSAnselField__Input--Cover"),f=e.$image.prev(".JSAnselField__Image"),m=e.$image.next(".JSAnselField__Image"),v=e.$fieldsModal.find(".AnselField__FieldsModalFooterSecondaryButtons");function y(){l.val(""),u.val(""),g.val(""),l.val(c.val()),u.val(h.val()),g.val(p.val()),p.val()&&e.commonStorage.eventTriggers.set("activeCover",e.uuid)}function w(){a&&(a.hide(),a.destroy(),a=null)}r.attr("src",e.$imageTag.attr("src")),s.text(e.fileName),e.$fieldsModal.find(".lightswitch").lightswitch(),c.val(l.val()),h.val(u.val()),g.val()&&d.trigger("mousedown").trigger("mouseup"),t.on("click",function(){w()}),n.on("click",function(){y(),w()}),f.length?i.on("click",function(){y(),a.hide(),e.commonStorage.eventTriggers.set("openFieldEditor",""),setTimeout(function(){w(),e.commonStorage.eventTriggers.set("openFieldEditor",f.data("jsUuid"))},50)}):i.addClass("disabled"),m.length?o.on("click",function(){y(),a.hide(),e.commonStorage.eventTriggers.set("openFieldEditor",""),setTimeout(function(){w(),e.commonStorage.eventTriggers.set("openFieldEditor",m.data("jsUuid"))},50)}):o.addClass("disabled"),f.length||m.length||v.hide()},watchOpenFieldEditor:function(){var e=this;e.commonStorage.eventTriggers.onChange("openFieldEditor."+e.uuid,function(t){t===e.uuid&&setTimeout(function(){e.openFieldEditor()},50)})},watchForCoverChange:function(){var e=this;e.commonStorage.eventTriggers.onChange("activeCover."+e.uuid,function(t){t!==e.uuid&&e.$image.find(".JSAnselField__Input--Cover").val("")})},watchForOrderChange:function(){var e=this;function t(){var t=e.$image.prevAll(".JSAnselField__Image").length+1,n=e.commonStorage.sharedModel.get("maxQty");!n||t<=n?e.model.set("isOverAllowed",!1):e.model.set("isOverAllowed",!0)}e.model.onChange("isOverAllowed."+e.uuid,function(t){t?e.$image.addClass("AnselField__Image--IsOverMax"):e.$image.removeClass("AnselField__Image--IsOverMax")}),e.commonStorage.eventTriggers.onChange("orderChange."+e.uuid,function(){t()}),t()},watchForRemove:function(){var e=this;e.$image.find(".JSAnselField__ImageIconRemove").on("click."+e.uuid,function(){e.remove()})},remove:function(){var e=this,t=e.commonStorage.eventTriggers.get("imageControllerUuids").slice(0);e.$image.find(".JSAnselField__ImageIconRemove").off("click."+e.uuid),e.commonStorage.eventTriggers.offChange("orderChange."+e.uuid),e.model.offChange("isOverAllowed."+e.uuid),e.commonStorage.eventTriggers.offChange("activeCover."+e.uuid),e.commonStorage.eventTriggers.offChange("openFieldEditor."+e.uuid),e.$image.find(".JSAnselField__ImageIconEdit").off("click."+e.uuid),e.commonStorage.sorter.removeItems(e.$image),e.$image.remove(),e.$imageTag=null,e.$image=null,e.$fieldsModal=null,e.base64Image=null,e.cacheFile=null,e.fileName=null,e.uuid=null,e.model=null,t.splice(t.indexOf(e.uuid),1),e.commonStorage.eventTriggers.set("imageControllerUuids",t)}}):setTimeout(function(){runImage(e)},10)}function runMaxTracker(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("MaxTracker",{commonStorage:{},notification:null,model:{isOverMax:"bool",isAtMax:"bool"},init:function(){var e=this;e.model.onChange("isOverMax",function(t){t?e.setOver():e.removeOver()}),e.commonStorage.sharedModel.get("preventUploadOverMax")&&e.model.onChange("isAtMax",function(t){t?e.preventUploads():e.allowUploads()}),e.checkImageCount(),e.commonStorage.eventTriggers.onChange("imageControllerUuids",function(){e.checkImageCount()})},checkImageCount:function(){var e=this.commonStorage.eventTriggers.get("imageControllerUuids").length,t=this.commonStorage.sharedModel.get("maxQty");this.model.set("isAtMax",t&&e>=t),this.model.set("isOverMax",t&&e>t)},setOver:function(){var t=this.commonStorage.sharedModel.get("maxQty"),n=t>1?"images":"image";this.notification||(this.notification=e.controller.construct("Notification",{commonStorage:this.commonStorage,message:"This field is limited to "+t+" "+n+". All images uploaded beyond that will not be displayed."}))},removeOver:function(){this.notification&&(this.notification.destroy(),this.notification=null)},preventUploads:function(){var e=this.commonStorage.$el.find(".JSAnselField__DropImagesToUpload");(e=e.add(this.commonStorage.$el.find(".JSAnselField__SelectImage"))).hide()},allowUploads:function(){var e=this.commonStorage.$el.find(".JSAnselField__DropImagesToUpload");(e=e.add(this.commonStorage.$el.find(".JSAnselField__SelectImage"))).show()}}):setTimeout(function(){runMaxTracker(e)},10)}function runMinTracker(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("MinTracker",{commonStorage:{},notification:null,model:{isUnderMin:"bool"},init:function(){var e=this;e.model.onChange("isUnderMin",function(t){t?e.setUnder():e.removeUnder()}),e.checkImageCount(),e.commonStorage.eventTriggers.onChange("imageControllerUuids",function(){e.checkImageCount()})},checkImageCount:function(){var e=this.commonStorage.eventTriggers.get("imageControllerUuids").length,t=this.commonStorage.sharedModel.get("minQty");!t||e>=t?this.model.set("isUnderMin",!1):this.model.set("isUnderMin",!0)},setUnder:function(){var t=this.commonStorage.sharedModel.get("minQty"),n=t>1?"images":"image";this.notification||(this.notification=e.controller.construct("Notification",{commonStorage:this.commonStorage,message:"This field requires at least "+t+" "+n+"."}))},removeUnder:function(){this.notification&&(this.notification.destroy(),this.notification=null)}}):setTimeout(function(){runMinTracker(e)},10)}function runNotification(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Notification",{commonStorage:{},error:!1,heading:"",message:"",destroyEvents:[],$line:null,init:function(){var e=this,t="";e.$line=$('<li class="AnselField__Notification JSAnselField__Notification"></li>'),e.heading&&(t+="<strong>"+e.heading+"</strong>: "),t+=e.message,e.$line.html(t),e.error&&e.$line.addClass("AnselField__Notification--IsError"),e.$line.appendTo(e.commonStorage.$notificationList),e.commonStorage.eventTriggers.set("notificationChange",e.commonStorage.eventTriggers.get("notificationChange")+1),e.destroyEvents.forEach(function(t){e.commonStorage.eventTriggers.onChange(t+"."+e.uuid,function(){e.destroy()})})},destroy:function(){var e=this;e.$line.remove(),e.destroyEvents.forEach(function(t){e.commonStorage.eventTriggers.offChange(t+"."+e.uuid)}),e.commonStorage.eventTriggers.set("notificationChange",e.commonStorage.eventTriggers.get("notificationChange")+1)}}):setTimeout(function(){runNotification(e)},10)}function runNotifications(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Notifications",{commonStorage:{},$notifications:null,init:function(){var e=this;e.commonStorage.eventTriggers.onChange("notificationChange",function(){setTimeout(function(){e.triggerChange()},500)})},triggerChange:function(){var e=this.commonStorage.$notificationList;e.find(".JSAnselField__Notification").length?e.addClass("AnselField__Notifications--HasNotifications"):e.removeClass("AnselField__Notifications--HasNotifications")}}):setTimeout(function(){runNotifications(e)},10)}function runMain(e){"use strict";window.jQuery&&e.controller&&e.model?$(".JSAnselField").each(function(){e.controller.construct("Field",{el:this})}):setTimeout(function(){runMain(e)},10)}window.FABNAMESPACE="ANSEL",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";var t=function(n,i){var o=navigator.userAgent.toLowerCase();this.opt=e.extend({},t.defaults,i||{}),this.container=e(n),this.opt.is_msie=/msie/.test(o),this.opt.is_ie_lt9=/msie [1-8]\./.test(o),this.container.addClass(this.opt.css_container),this.ui={},this.state=null,this.ui.multi=[],this.ui.selection=null,this.filter={},this.init(),this.setOptions(i),this.applySizeConstraints(),this.container.trigger("cropinit",this),this.opt.is_ie_lt9&&(this.opt.dragEventTarget=document.body)};e.extend(t,{component:{},filter:{},stage:{},registerComponent:function(e,n){t.component[e]=n},registerFilter:function(e,n){t.filter[e]=n},registerStageType:function(e,n){t.stage[e]=n},attach:function(t,n){return new e.JcropAnsel(t,n)},imgCopy:function(e){var t=new Image;return t.src=e.src,t},imageClone:function(n){return e.JcropAnsel.supportsCanvas?t.canvasClone(n):t.imgCopy(n)},canvasClone:function(t){var n=document.createElement("canvas"),i=n.getContext("2d");return e(n).width(t.width).height(t.height),n.width=t.naturalWidth,n.height=t.naturalHeight,i.drawImage(t,0,0,t.naturalWidth,t.naturalHeight),n},propagate:function(e,t,n){for(var i=0,o=e.length;i<o;i++)t.hasOwnProperty(e[i])&&(n[e[i]]=t[e[i]])},getLargestBox:function(e,t,n){return t/n>e?[n*e,n]:[t,t/e]},stageConstructor:function(n,i,o){var r=[];e.each(t.stage,function(e,t){r.push(t)}),r.sort(function(e,t){return e.priority-t.priority});for(var s=0,a=r.length;s<a;s++)if(r[s].isSupported(n,i)){r[s].create(n,i,function(e,t){"function"==typeof o&&o(e,t)});break}},supportsColorFade:function(){return e.fx.step.hasOwnProperty("backgroundColor")},wrapFromXywh:function(e){var t={x:e[0],y:e[1],w:e[2],h:e[3]};return t.x2=t.x+t.w,t.y2=t.y+t.h,t}});var i=function(){};e.extend(i,{isSupported:function(e,t){return!0},priority:100,create:function(e,t,n){var o=new i;o.element=e,n.call(this,o,t)},prototype:{attach:function(e){this.init(e),e.ui.stage=this},triggerEvent:function(t){return e(this.element).trigger(t),this},getElement:function(){return this.element}}}),t.registerStageType("Block",i);var o=function(){};o.prototype=new i,e.extend(o,{isSupported:function(e,t){if("IMG"==e.tagName)return!0},priority:90,create:function(t,n,i){e.JcropAnsel.component.ImageLoader.attach(t,function(r,s){var a=new o;a.element=e(t).wrap("<div />").parent(),a.element.width(r).height(s),a.imgsrc=t,"function"==typeof i&&i.call(this,a,n)})}}),t.registerStageType("Image",o);var r=function(){this.angle=0,this.scale=1,this.scaleMin=.2,this.scaleMax=1.25,this.offset=[0,0]};r.prototype=new o,e.extend(r,{isSupported:function(t,n){if(e.JcropAnsel.supportsCanvas&&"IMG"==t.tagName)return!0},priority:60,create:function(t,n,i){var o=e(t),s=e.extend({},n);e.JcropAnsel.component.ImageLoader.attach(t,function(e,n){var a=new r;o.hide(),a.createCanvas(t,e,n),o.before(a.element),a.imgsrc=t,s.imgsrc=t,"function"==typeof i&&(i(a,s),a.redraw())})}}),e.extend(r.prototype,{init:function(e){this.core=e},setOffset:function(e,t){return this.offset=[e,t],this},setAngle:function(e){return this.angle=e,this},setScale:function(e){return this.scale=this.boundScale(e),this},boundScale:function(e){return e<this.scaleMin?e=this.scaleMin:e>this.scaleMax&&(e=this.scaleMax),e},createCanvas:function(t,n,i){this.width=n,this.height=i,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=i,this.$canvas=e(this.canvas).width("100%").height("100%"),this.context=this.canvas.getContext("2d"),this.fillstyle="rgba(0,0,0,0)",this.element=this.$canvas.wrap("<div />").parent().width(n).height(i)},triggerEvent:function(e){return this.$canvas.trigger(e),this},clear:function(){return this.context.fillStyle=this.fillstyle,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this},redraw:function(){return this.context.save(),this.clear(),this.context.translate(parseInt(.5*this.width),parseInt(.5*this.height)),this.context.translate(this.offset[0]/this.core.opt.xscale,this.offset[1]/this.core.opt.yscale),this.context.rotate(this.angle*(Math.PI/180)),this.context.scale(this.scale,this.scale),this.context.translate(-parseInt(.5*this.width),-parseInt(.5*this.height)),this.context.drawImage(this.imgsrc,0,0,this.width,this.height),this.context.restore(),this.$canvas.trigger("cropredraw"),this},setFillStyle:function(e){return this.fillstyle=e,this}}),t.registerStageType("Canvas",r);var s=function(){this.minw=40,this.minh=40,this.maxw=0,this.maxh=0,this.core=null};e.extend(s.prototype,{tag:"backoff",priority:22,filter:function(e){var t=this.bound;return e.x<t.minx&&(e.x=t.minx,e.x2=e.w+e.x),e.y<t.miny&&(e.y=t.miny,e.y2=e.h+e.y),e.x2>t.maxx&&(e.x2=t.maxx,e.x=e.x2-e.w),e.y2>t.maxy&&(e.y2=t.maxy,e.y=e.y2-e.h),e},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.bound={minx:0+e.edge.w,miny:0+e.edge.n,maxx:this.elw+e.edge.e,maxy:this.elh+e.edge.s}}}),t.registerFilter("backoff",s);var a=function(){this.core=null};e.extend(a.prototype,{tag:"constrain",priority:5,filter:function(e,t){return"move"==t?(e.x<this.minx&&(e.x=this.minx,e.x2=e.w+e.x),e.y<this.miny&&(e.y=this.miny,e.y2=e.h+e.y),e.x2>this.maxx&&(e.x2=this.maxx,e.x=e.x2-e.w),e.y2>this.maxy&&(e.y2=this.maxy,e.y=e.y2-e.h)):(e.x<this.minx&&(e.x=this.minx),e.y<this.miny&&(e.y=this.miny),e.x2>this.maxx&&(e.x2=this.maxx),e.y2>this.maxy&&(e.y2=this.maxy)),e.w=e.x2-e.x,e.h=e.y2-e.y,e},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.minx=0+e.edge.w,this.miny=0+e.edge.n,this.maxx=this.elw+e.edge.e,this.maxy=this.elh+e.edge.s}}),t.registerFilter("constrain",a);var c=function(){this.core=null};e.extend(c.prototype,{tag:"extent",priority:12,offsetFromCorner:function(e,t,n){var i=t[0],o=t[1];switch(e){case"bl":return[n.x2-i,n.y,i,o];case"tl":return[n.x2-i,n.y2-o,i,o];case"br":return[n.x,n.y,i,o];case"tr":return[n.x,n.y2-o,i,o]}},getQuadrant:function(e){var t=e.opposite[0]-e.offsetx,n=e.opposite[1]-e.offsety;return t<0&&n<0?"br":t>=0&&n>=0?"tl":t<0&&n>=0?"tr":"bl"},filter:function(e,n,i){if("move"==n)return e;var o=e.w,r=e.h,s=i.state,a=this.limits,c=s?this.getQuadrant(s):"br";return a.minw&&o<a.minw&&(o=a.minw),a.minh&&r<a.minh&&(r=a.minh),a.maxw&&o>a.maxw&&(o=a.maxw),a.maxh&&r>a.maxh&&(r=a.maxh),o==e.w&&r==e.h?e:t.wrapFromXywh(this.offsetFromCorner(c,[o,r],e))},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.limits={minw:e.minSize[0],minh:e.minSize[1],maxw:e.maxSize[0],maxh:e.maxSize[1]}}}),t.registerFilter("extent",c);var l=function(){this.stepx=1,this.stepy=1,this.core=null};e.extend(l.prototype,{tag:"grid",priority:19,filter:function(e){var t={x:Math.round(e.x/this.stepx)*this.stepx,y:Math.round(e.y/this.stepy)*this.stepy,x2:Math.round(e.x2/this.stepx)*this.stepx,y2:Math.round(e.y2/this.stepy)*this.stepy};return t.w=t.x2-t.x,t.h=t.y2-t.y,t}}),t.registerFilter("grid",l);var h=function(){this.ratio=0,this.core=null};e.extend(h.prototype,{tag:"ratio",priority:15,offsetFromCorner:function(e,t,n){var i=t[0],o=t[1];switch(e){case"bl":return[n.x2-i,n.y,i,o];case"tl":return[n.x2-i,n.y2-o,i,o];case"br":return[n.x,n.y,i,o];case"tr":return[n.x,n.y2-o,i,o]}},getBoundRatio:function(e,n){var i=t.getLargestBox(this.ratio,e.w,e.h);return t.wrapFromXywh(this.offsetFromCorner(n,i,e))},getQuadrant:function(e){var t=e.opposite[0]-e.offsetx,n=e.opposite[1]-e.offsety;return t<0&&n<0?"br":t>=0&&n>=0?"tl":t<0&&n>=0?"tr":"bl"},filter:function(e,t,n){if(!this.ratio)return e;e.w,e.h;var i=n.state,o=i?this.getQuadrant(i):"br";if("move"==(t=t||"se"))return e;switch(t){case"n":e.x2=this.elw,e.w=e.x2-e.x,o="tr";break;case"s":e.x2=this.elw,e.w=e.x2-e.x,o="br";break;case"e":e.y2=this.elh,e.h=e.y2-e.y,o="br";break;case"w":e.y2=this.elh,e.h=e.y2-e.y,o="bl"}return this.getBoundRatio(e,o)},refresh:function(e){this.ratio=e.aspectRatio,this.elw=e.core.container.width(),this.elh=e.core.container.height()}}),t.registerFilter("ratio",h);var u=function(){this.core=null};e.extend(u.prototype,{tag:"round",priority:90,filter:function(e){var t={x:Math.round(e.x),y:Math.round(e.y),x2:Math.round(e.x2),y2:Math.round(e.y2)};return t.w=t.x2-t.x,t.h=t.y2-t.y,t}}),t.registerFilter("round",u);var d=function(e,t){this.color=t||"black",this.opacity=e||.5,this.core=null,this.shades={}};e.extend(d.prototype,{tag:"shader",fade:!0,fadeEasing:"swing",fadeSpeed:320,priority:95,init:function(){var t=this;t.attached||(t.visible=!1,t.container=e("<div />").addClass(t.core.opt.css_shades).prependTo(this.core.container).hide(),t.elh=this.core.container.height(),t.elw=this.core.container.width(),t.shades={top:t.createShade(),right:t.createShade(),left:t.createShade(),bottom:t.createShade()},t.attached=!0)},destroy:function(){this.container.remove()},setColor:function(n,i){var o=this;if(n==o.color)return o;this.color=n;var r=t.supportsColorFade();return e.each(o.shades,function(e,t){o.fade&&!i&&r?t.animate({backgroundColor:n},{queue:!1,duration:o.fadeSpeed,easing:o.fadeEasing}):t.css("backgroundColor",n)}),o},setOpacity:function(t,n){var i=this;return t==i.opacity?i:(i.opacity=t,e.each(i.shades,function(e,o){!i.fade||n?o.css({opacity:t}):o.animate({opacity:t},{queue:!1,duration:i.fadeSpeed,easing:i.fadeEasing})}),i)},createShade:function(){return e("<div />").css({position:"absolute",backgroundColor:this.color,opacity:this.opacity}).appendTo(this.container)},refresh:function(e){var t=this.core,n=this.shades;this.setColor(e.bgColor?e.bgColor:this.core.opt.bgColor),this.setOpacity(e.bgOpacity?e.bgOpacity:this.core.opt.bgOpacity),this.elh=t.container.height(),this.elw=t.container.width(),n.right.css("height",this.elh+"px"),n.left.css("height",this.elh+"px")},filter:function(e,t,n){if(!n.active)return e;var i=this,o=i.shades;return o.top.css({left:Math.round(e.x)+"px",width:Math.round(e.w)+"px",height:Math.round(e.y)+"px"}),o.bottom.css({top:Math.round(e.y2)+"px",left:Math.round(e.x)+"px",width:Math.round(e.w)+"px",height:i.elh-Math.round(e.y2)+"px"}),o.right.css({left:Math.round(e.x2)+"px",width:i.elw-Math.round(e.x2)+"px"}),o.left.css({width:Math.round(e.x)+"px"}),i.visible||(i.container.show(),i.visible=!0),e}}),t.registerFilter("shader",d);var p=function(e){this.stage=e,this.core=e.core,this.cloneStagePosition()};p.prototype={cloneStagePosition:function(){var e=this.stage;this.angle=e.angle,this.scale=e.scale,this.offset=e.offset},getElement:function(){var t=this.stage;return e("<div />").css({position:"absolute",top:t.offset[0]+"px",left:t.offset[1]+"px",width:t.angle+"px",height:t.scale+"px"})},animate:function(e){var t=this;this.scale=this.stage.boundScale(this.scale),t.stage.triggerEvent("croprotstart"),t.getElement().animate({top:t.offset[0]+"px",left:t.offset[1]+"px",width:t.angle+"px",height:t.scale+"px"},{easing:t.core.opt.animEasing,duration:t.core.opt.animDuration,complete:function(){t.stage.triggerEvent("croprotend"),"function"==typeof e&&e.call(this)},progress:function(e){var n,i={},o=e.tweens;for(n=0;n<o.length;n++)i[o[n].prop]=o[n].now;t.stage.setAngle(i.width).setScale(i.height).setOffset(i.top,i.left).redraw()}})}},t.stage.Canvas.prototype.getAnimator=function(){return new p(this)},t.registerComponent("CanvasAnimator",p);var g=function(e){this.selection=e,this.core=e.core};g.prototype={getElement:function(){var t=this.selection.get();return e("<div />").css({position:"absolute",top:t.y+"px",left:t.x+"px",width:t.w+"px",height:t.h+"px"})},animate:function(e,t,n,i,o){var r=this;r.selection.allowResize(!1),r.getElement().animate({top:t+"px",left:e+"px",width:n+"px",height:i+"px"},{easing:r.core.opt.animEasing,duration:r.core.opt.animDuration,complete:function(){r.selection.allowResize(!0),o&&o.call(this)},progress:function(e){var t,n={},i=e.tweens;for(t=0;t<i.length;t++)n[i[t].prop]=i[t].now;var o={x:parseInt(n.left),y:parseInt(n.top),w:parseInt(n.width),h:parseInt(n.height)};o.x2=o.x+o.w,o.y2=o.y+o.h,r.selection.updateRaw(o,"se")}})}},t.registerComponent("Animator",g);var f=function(e,t,n){var i=this;i.x=e.pageX,i.y=e.pageY,i.selection=t,i.eventTarget=t.core.opt.dragEventTarget,i.orig=t.get(),t.callFilterFunction("refresh");var o=t.core.container.position();i.elx=o.left,i.ely=o.top,i.offsetx=0,i.offsety=0,i.ord=n,i.opposite=i.getOppositeCornerOffset(),i.initEvents(e)};f.prototype={getOppositeCornerOffset:function(){var e=this.orig,t=this.x-this.elx-e.x,n=this.y-this.ely-e.y;switch(this.ord){case"nw":case"w":return[e.w-t,e.h-n];case"sw":return[e.w-t,-n];case"se":case"s":case"e":return[-t,-n];case"ne":case"n":return[-t,e.h-n]}return[null,null]},initEvents:function(t){e(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())},dragEvent:function(e){this.offsetx=e.pageX-this.x,this.offsety=e.pageY-this.y,this.selection.updateRaw(this.getBox(),this.ord)},endDragEvent:function(e){var t=this.selection;t.core.container.removeClass("jcrop-dragging"),t.element.trigger("cropend",[t,t.core.unscale(t.get())]),t.focus()},createStopHandler:function(){var t=this;return function(n){return e(t.eventTarget).off(".jcrop"),t.endDragEvent(n),!1}},createDragHandler:function(){var e=this;return function(t){return e.dragEvent(t),!1}},update:function(e,t){this.offsetx=e-this.x,this.offsety=t-this.y},resultWrap:function(e){var t={x:Math.min(e[0],e[2]),y:Math.min(e[1],e[3]),x2:Math.max(e[0],e[2]),y2:Math.max(e[1],e[3])};return t.w=t.x2-t.x,t.h=t.y2-t.y,t},getBox:function(){var e=this,t=e.orig,n={x2:t.x+t.w,y2:t.y+t.h};switch(e.ord){case"n":return e.resultWrap([t.x,e.offsety+t.y,n.x2,n.y2]);case"s":return e.resultWrap([t.x,t.y,n.x2,e.offsety+n.y2]);case"e":return e.resultWrap([t.x,t.y,e.offsetx+n.x2,n.y2]);case"w":return e.resultWrap([t.x+e.offsetx,t.y,n.x2,n.y2]);case"sw":return e.resultWrap([e.offsetx+t.x,t.y,n.x2,e.offsety+n.y2]);case"se":return e.resultWrap([t.x,t.y,e.offsetx+n.x2,e.offsety+n.y2]);case"ne":return e.resultWrap([t.x,e.offsety+t.y,e.offsetx+n.x2,n.y2]);case"nw":return e.resultWrap([e.offsetx+t.x,e.offsety+t.y,n.x2,n.y2]);case"move":return n.nx=t.x+e.offsetx,n.ny=t.y+e.offsety,e.resultWrap([n.nx,n.ny,n.nx+t.w,n.ny+t.h])}}},t.registerComponent("DragState",f);var m=function(e){this.core=e};m.prototype={on:function(t,n){e(this).on(t,n)},off:function(t){e(this).off(t)},trigger:function(t){e(this).trigger(t)}},t.registerComponent("EventManager",m);var v=function(e,t,n){this.src=e,t||(t=new Image),this.element=t,this.callback=n,this.load()};e.extend(v,{attach:function(e,t){return new v(e.src,e,t)},prototype:{getDimensions:function(){var e=this.element;return e.naturalWidth?[e.naturalWidth,e.naturalHeight]:e.width?[e.width,e.height]:null},fireCallback:function(){this.element.onload=null,"function"==typeof this.callback&&this.callback.apply(this,this.getDimensions())},isLoaded:function(){return this.element.complete},load:function(){var e=this;e.element.src=e.src,e.isLoaded()?e.fireCallback():e.element.onload=function(t){e.fireCallback()}}}}),t.registerComponent("ImageLoader",v);var y=function(e){this.core=e,this.init()};e.extend(y,{support:function(){if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0},prototype:{init:function(){var t=e.JcropAnsel.component.DragState.prototype;t.touch||(this.initEvents(),this.shimDragState(),this.shimStageDrag(),t.touch=!0)},shimDragState:function(){var t=this;e.JcropAnsel.component.DragState.prototype.initEvents=function(n){"touch"==n.type.substr(0,5)?e(this.eventTarget).on("touchmove.jcrop.jcrop-touch",t.dragWrap(this.createDragHandler())).on("touchend.jcrop.jcrop-touch",this.createStopHandler()):e(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())}},shimStageDrag:function(){this.core.container.addClass("jcrop-touch").on("touchstart.jcrop.jcrop-stage",this.dragWrap(this.core.ui.manager.startDragHandler()))},dragWrap:function(e){return function(t){return t.preventDefault(),t.stopPropagation(),"touch"==t.type.substr(0,5)&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,e(t))}},initEvents:function(){var e=this.core;e.container.on("touchstart.jcrop.jcrop-touch","."+e.opt.css_drag,this.dragWrap(e.startDrag()))}}}),t.registerComponent("Touch",y);var w=function(e){this.core=e,this.init()};e.extend(w,{defaults:{eventName:"keydown.jcrop",passthru:[9],debug:!1},prototype:{init:function(){e.extend(this,w.defaults),this.enable()},disable:function(){this.core.container.off(this.eventName)},enable:function(){var t=this,n=t.core;n.container.on(t.eventName,function(i){var o=i.shiftKey?16:2;if(e.inArray(i.keyCode,t.passthru)>=0)return!0;switch(i.keyCode){case 37:n.nudge(-o,0);break;case 38:n.nudge(0,-o);break;case 39:n.nudge(o,0);break;case 40:n.nudge(0,o);break;case 46:case 8:return n.requestDelete(),!1;default:t.debug&&console.log("keycode: "+i.keyCode)}i.metaKey||i.ctrlKey||i.preventDefault()})}}}),t.registerComponent("Keyboard",w);var x=function(){};e.extend(x,{defaults:{minSize:[8,8],maxSize:[0,0],aspectRatio:0,edge:{n:0,s:0,e:0,w:0},bgColor:null,bgOpacity:null,last:null,state:null,active:!0,linked:!0,canDelete:!0,canDrag:!0,canResize:!0,canSelect:!0},prototype:{init:function(e){this.core=e,this.startup(),this.linked=this.core.opt.linked,this.attach(),this.setOptions(this.core.opt),e.container.trigger("cropcreate",[this])},attach:function(){},startup:function(){var t=this,n=t.core.opt;e.extend(t,x.defaults),t.filter=t.core.getDefaultFilters(),t.element=e("<div />").addClass(n.css_selection).data({selection:t}),t.frame=e("<button />").addClass(n.css_button).data("ord","move").attr("type","button"),t.element.append(t.frame).appendTo(t.core.container),t.core.opt.is_msie&&t.frame.css({opacity:0,backgroundColor:"white"}),t.insertElements(),t.frame.on("focus.jcrop",function(e){t.core.setSelection(t),t.element.trigger("cropfocus",t),t.element.addClass("jcrop-focus")}).on("blur.jcrop",function(e){t.element.removeClass("jcrop-focus"),t.element.trigger("cropblur",t)})},propagate:["canDelete","canDrag","canResize","canSelect","minSize","maxSize","aspectRatio","edge"],setOptions:function(e){return t.propagate(this.propagate,e,this),this.refresh(),this},refresh:function(){this.allowResize(),this.allowDrag(),this.allowSelect(),this.callFilterFunction("refresh"),this.updateRaw(this.get(),"se")},callFilterFunction:function(e,t){for(var n=0;n<this.filter.length;n++)this.filter[n][e]&&this.filter[n][e](this);return this},addFilter:function(e){e.core=this.core,this.hasFilter(e)||(this.filter.push(e),this.sortFilters(),e.init&&e.init(),this.refresh())},hasFilter:function(e){var t,n=this.filter;for(t=0;t<n.length;t++)if(n[t]===e)return!0},sortFilters:function(){this.filter.sort(function(e,t){return e.priority-t.priority})},clearFilters:function(){for(var e=this.filter,t=0;t<e.length;t++)e[t].destroy&&e[t].destroy();this.filter=[]},removeFilter:function(e){for(var t=this.filter,n=[],i=0;i<t.length;i++)t[i].tag&&t[i].tag==e||e===t[i]?t[i].destroy&&t[i].destroy():n.push(t[i]);this.filter=n},runFilters:function(e,t){for(var n=0;n<this.filter.length;n++)e=this.filter[n].filter(e,t,this);return e},endDrag:function(){this.state&&(e(document.body).off(".jcrop"),this.focus(),this.state=null)},startDrag:function(n,i){this.core;return i=i||e(n.target).data("ord"),this.focus(),("move"!=i||!this.element.hasClass(this.core.opt.css_nodrag))&&(this.state=new t.component.DragState(n,this,i),!1)},allowSelect:function(e){return void 0===e&&(e=this.canSelect),e&&this.canSelect?this.frame.attr("disabled",!1):this.frame.attr("disabled","disabled"),this},allowDrag:function(e){var t=this,n=t.core.opt;return null==e&&(e=t.canDrag),e&&t.canDrag?t.element.removeClass(n.css_nodrag):t.element.addClass(n.css_nodrag),this},allowResize:function(e){var t=this,n=t.core.opt;return null==e&&(e=t.canResize),e&&t.canResize?t.element.removeClass(n.css_noresize):t.element.addClass(n.css_noresize),this},remove:function(){this.element.trigger("cropremove",this),this.element.remove()},toBack:function(){this.active=!1,this.element.removeClass("jcrop-current jcrop-focus")},toFront:function(){this.active=!0,this.element.addClass("jcrop-current"),this.callFilterFunction("refresh"),this.refresh()},redraw:function(e){return this.moveTo(e.x,e.y),this.resize(e.w,e.h),this.last=e,this},update:function(e,t){return this.updateRaw(this.core.scale(e),t)},updateRaw:function(e,t){return e=this.runFilters(e,t),this.redraw(e),this.element.trigger("cropmove",[this,this.core.unscale(e)]),this},animateTo:function(e,n){var i=new t.component.Animator(this),o=this.core.scale(t.wrapFromXywh(e));i.animate(o.x,o.y,o.w,o.h,n)},center:function(e){var t=this.get(),n=this.core,i=n.container.width(),o=n.container.height(),r=[(i-t.w)/2,(o-t.h)/2,t.w,t.h];return this[e?"setSelect":"animateTo"](r)},createElement:function(t,n){return e("<div />").addClass(t+" ord-"+n).data("ord",n)},moveTo:function(e,t){this.element.css({top:t+"px",left:e+"px"})},blur:function(){return this.element.blur(),this},focus:function(){return this.core.setSelection(this),this.frame.focus(),this},resize:function(e,t){this.element.css({width:e+"px",height:t+"px"})},get:function(){var e=this.element,t=e.position(),n=e.width(),i=e.height(),o={x:t.left,y:t.top};return o.x2=o.x+n,o.y2=o.y+i,o.w=n,o.h=i,o},insertElements:function(){var e,t=this,n=(t.core,t.element),i=t.core.opt,o=i.borders,r=i.handles,s=i.dragbars;for(e=0;e<s.length;e++)n.append(t.createElement(i.css_dragbars,s[e]));for(e=0;e<r.length;e++)n.append(t.createElement(i.css_handles,r[e]));for(e=0;e<o.length;e++)n.append(t.createElement(i.css_borders,o[e]))}}}),t.registerComponent("Selection",x);var S=function(t,n){e.extend(this,S.defaults,n||{}),this.manager=t,this.core=t.core};S.defaults={offset:[-8,-8],active:!0,minsize:[20,20]},e.extend(S.prototype,{start:function(n){var i=this.core;if(i.opt.allowSelect){if(i.opt.multi&&i.opt.multiMax&&i.ui.multi.length>=i.opt.multiMax)return!1;var o=e(n.currentTarget).offset(),r=n.pageX-o.left+this.offset[0],s=n.pageY-o.top+this.offset[1],a=i.ui.multi;if(!i.opt.multi)if(i.opt.multiCleanup){for(var c=0;c<a.length;c++)a[c].remove();i.ui.multi=[]}else i.removeSelection(i.ui.selection);i.container.addClass("jcrop-dragging");var l=i.newSelection().updateRaw(t.wrapFromXywh([r,s,1,1]));return l.element.trigger("cropstart",[l,this.core.unscale(l.get())]),l.startDrag(n,"se")}},end:function(e,t){this.drag(e,t);var n=this.sel.get();this.core.container.removeClass("jcrop-dragging"),n.w<this.minsize[0]||n.h<this.minsize[1]?this.core.requestDelete():this.sel.focus()}}),t.registerComponent("StageDrag",S);var C=function(e){this.core=e,this.ui=e.ui,this.init()};e.extend(C.prototype,{init:function(){this.setupEvents(),this.dragger=new S(this)},tellConfigUpdate:function(e){for(var t=0,n=this.ui.multi,i=n.length;t<i;t++)n[t].setOptions&&(n[t].linked||this.core.opt.linkCurrent&&n[t]==this.ui.selection)&&n[t].setOptions(e)},startDragHandler:function(){var e=this;return function(t){if(!t.button||e.core.opt.is_ie_lt9)return e.dragger.start(t)}},removeEvents:function(){this.core.event.off(".jcrop-stage"),this.core.container.off(".jcrop-stage")},shimLegacyHandlers:function(t){var n,i=this.core;e.each(i.opt.legacyHandlers,function(e,o){e in t&&(n=t[e],i.container.off(".jcrop-"+e).on(o+".jcrop.jcrop-"+e,function(e,t,o){n.call(i,o)}),delete t[e])})},setupEvents:function(){var e=this,t=e.core;t.event.on("configupdate.jcrop-stage",function(n){e.shimLegacyHandlers(t.opt),e.tellConfigUpdate(t.opt),t.container.trigger("cropconfig",[t,t.opt])}),this.core.container.on("mousedown.jcrop.jcrop-stage",this.startDragHandler())}}),t.registerComponent("StageManager",C);var A=function(){};e.extend(A,{defaults:{selection:null,fading:!0,fadeDelay:1e3,fadeDuration:1e3,autoHide:!1,width:80,height:80,_hiding:null},prototype:{recopyCanvas:function(){var e=this.core.ui.stage,t=e.context;this.context.putImageData(t.getImageData(0,0,e.canvas.width,e.canvas.height),0,0)},init:function(t,n){var i=this;this.core=t,e.extend(this,A.defaults,n),i.initEvents(),i.refresh(),i.insertElements(),i.selection?(i.renderSelection(i.selection),i.selectionTarget=i.selection.element[0]):i.core.ui.selection&&i.renderSelection(i.core.ui.selection),i.core.ui.stage.canvas&&(i.context=i.preview[0].getContext("2d"),i.core.container.on("cropredraw",function(e){i.recopyCanvas(),i.refresh()}))},updateImage:function(t){return this.preview.remove(),this.preview=e(e.JcropAnsel.imageClone(t)),this.element.append(this.preview),this.refresh(),this},insertElements:function(){this.preview=e(e.JcropAnsel.imageClone(this.core.ui.stage.imgsrc)),this.element=e("<div />").addClass("jcrop-thumb").width(this.width).height(this.height).append(this.preview).appendTo(this.core.container)},resize:function(e,t){this.width=e,this.height=t,this.element.width(e).height(t),this.renderCoords(this.last)},refresh:function(){this.cw=this.core.opt.xscale*this.core.container.width(),this.ch=this.core.opt.yscale*this.core.container.height(),this.last&&this.renderCoords(this.last)},renderCoords:function(e){var t=this.width/e.w,n=this.height/e.h;return this.preview.css({width:Math.round(t*this.cw)+"px",height:Math.round(n*this.ch)+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(n*e.y)+"px"}),this.last=e,this},renderSelection:function(e){return this.renderCoords(e.core.unscale(e.get()))},selectionStart:function(e){this.renderSelection(e)},show:function(){this._hiding&&clearTimeout(this._hiding),this.fading?this.element.stop().animate({opacity:1},{duration:80,queue:!1}):this.element.stop().css({opacity:1})},hide:function(){var e=this;e.fading?e._hiding=setTimeout(function(){e._hiding=null,e.element.stop().animate({opacity:0},{duration:e.fadeDuration,queue:!1})},e.fadeDelay):e.element.hide()},initEvents:function(){var e=this;e.core.container.on("croprotstart croprotend cropimage cropstart cropmove cropend",function(t,n,i){if(e.selectionTarget&&e.selectionTarget!==t.target)return!1;switch(t.type){case"cropimage":e.updateImage(i);break;case"cropstart":e.selectionStart(n);case"croprotstart":e.show();break;case"cropend":e.renderCoords(i);case"croprotend":e.autoHide&&e.hide();break;case"cropmove":e.renderCoords(i)}})}}}),t.registerComponent("Thumbnailer",A);var F=function(){};F.prototype={init:function(t,n,i){n||(n=t.container),this.$btn=e(n),this.$targ=e(n),this.core=t,this.$btn.addClass("dialdrag").on("mousedown.dialdrag",this.mousedown()).data("dialdrag",this),e.isFunction(i)||(i=function(){}),this.callback=i,this.ondone=i},remove:function(){return this.$btn.removeClass("dialdrag").off(".dialdrag").data("dialdrag",null),this},setTarget:function(t){return this.$targ=e(t),this},getOffset:function(){var e=this.$targ,t=e.offset();return[t.left+e.width()/2,t.top+e.height()/2]},relMouse:function(e){var t=e.pageX-this.offset[0],n=e.pageY-this.offset[1];return[t,n,Math.atan2(n,t)*(180/Math.PI),Math.sqrt(Math.pow(t,2)+Math.pow(n,2))]},mousedown:function(){var t=this;function n(n){e(window).off(".dialdrag"),t.ondone.call(t,t.relMouse(n)),t.core.container.trigger("croprotend")}function i(e){t.callback.call(t,t.relMouse(e))}return function(o){t.offset=t.getOffset();var r=t.relMouse(o);return t.angleOffset=-t.core.ui.stage.angle+r[2],t.distOffset=r[3],t.dragOffset=[r[0],r[1]],t.core.container.trigger("croprotstart"),e(window).on("mousemove.dialdrag",i).on("mouseup.dialdrag",n),t.callback.call(t,t.relMouse(o)),!1}}},t.registerComponent("DialDrag",F),t.defaults={edge:{n:0,s:0,e:0,w:0},setSelect:null,linked:!0,linkCurrent:!0,canDelete:!0,canSelect:!0,canDrag:!0,canResize:!0,eventManagerComponent:t.component.EventManager,keyboardComponent:t.component.Keyboard,dragstateComponent:t.component.DragState,stagemanagerComponent:t.component.StageManager,animatorComponent:t.component.Animator,selectionComponent:t.component.Selection,stageConstructor:t.stageConstructor,allowSelect:!0,multi:!1,multiMax:!1,multiCleanup:!0,animation:!0,animEasing:"swing",animDuration:400,fading:!0,fadeDuration:300,fadeEasing:"swing",bgColor:"black",bgOpacity:.5,applyFilters:["constrain","extent","backoff","ratio","shader","round"],borders:["e","w","s","n"],handles:["n","s","e","w","sw","ne","nw","se"],dragbars:["n","e","w","s"],dragEventTarget:window,xscale:1,yscale:1,boxWidth:null,boxHeight:null,css_nodrag:"jcrop-nodrag",css_drag:"jcrop-drag",css_container:"jcrop-active",css_shades:"jcrop-shades",css_selection:"jcrop-selection",css_borders:"jcrop-border",css_handles:"jcrop-handle jcrop-drag",css_button:"jcrop-box jcrop-drag",css_noresize:"jcrop-noresize",css_dragbars:"jcrop-dragbar jcrop-drag",legacyHandlers:{onChange:"cropmove",onSelect:"cropend"}},e.extend(t.prototype,{init:function(){this.event=new this.opt.eventManagerComponent(this),this.ui.keyboard=new this.opt.keyboardComponent(this),this.ui.manager=new this.opt.stagemanagerComponent(this),this.applyFilters(),e.JcropAnsel.supportsTouch&&new e.JcropAnsel.component.Touch(this),this.initEvents()},applySizeConstraints:function(){var n=this.opt,i=this.opt.imgsrc;if(i){var o=i.naturalWidth||i.width,r=i.naturalHeight||i.height,s=n.boxWidth||o,a=n.boxHeight||r;if(i&&(o>s||r>a)){var c=t.getLargestBox(o/r,s,a);e(i).width(c[0]).height(c[1]),this.resizeContainer(c[0],c[1]),this.opt.xscale=o/c[0],this.opt.yscale=r/c[1]}}if(this.opt.trueSize){var l=this.opt.trueSize[0],h=this.opt.trueSize[1],u=this.getContainerSize();this.opt.xscale=l/u[0],this.opt.yscale=h/u[1]}},initComponent:function(e){if(t.component[e]){var n=Array.prototype.slice.call(arguments),i=new t.component[e];return n.shift(),n.unshift(this),i.init.apply(i,n),i}},setOptions:function(t,n){return e.isPlainObject(t)||(t={}),e.extend(this.opt,t),this.opt.setSelect&&(this.ui.multi.length||this.newSelection(),this.setSelect(this.opt.setSelect),this.opt.setSelect=null),this.event.trigger("configupdate"),this},destroy:function(){this.opt.imgsrc?(this.container.before(this.opt.imgsrc),this.container.remove(),e(this.opt.imgsrc).removeData("JcropAnsel").show()):this.container.remove()},applyFilters:function(){for(var t,n=0,i=this.opt.applyFilters,o=i.length;n<o;n++)e.JcropAnsel.filter[i[n]]&&(t=new e.JcropAnsel.filter[i[n]]),t.core=this,t.init&&t.init(),this.filter[i[n]]=t},getDefaultFilters:function(){for(var e=[],t=0,n=this.opt.applyFilters,i=n.length;t<i;t++)this.filter.hasOwnProperty(n[t])&&e.push(this.filter[n[t]]);return e.sort(function(e,t){return e.priority-t.priority}),e},setSelection:function(e){for(var t=this.ui.multi,n=[],i=0;i<t.length;i++)t[i]!==e&&n.push(t[i]),t[i].toBack();return n.unshift(e),this.ui.multi=n,this.ui.selection=e,e.toFront(),e},getSelection:function(e){return this.ui.selection.get()},newSelection:function(e){return e||(e=new this.opt.selectionComponent),e.init(this),this.setSelection(e),e},hasSelection:function(e){for(var t=0;t<this.ui.multi;t++)if(e===this.ui.multi[t])return!0},removeSelection:function(e){for(var t=[],n=this.ui.multi,i=0;i<n.length;i++)e!==n[i]?t.push(n[i]):n[i].remove();return this.ui.multi=t},addFilter:function(e){for(var t=0,n=this.ui.multi,i=n.length;t<i;t++)n[t].addFilter(e);return this},removeFilter:function(e){for(var t=0,n=this.ui.multi,i=n.length;t<i;t++)n[t].removeFilter(e);return this},blur:function(){return this.ui.selection.blur(),this},focus:function(){return this.ui.selection.focus(),this},initEvents:function(){this.container.on("selectstart",function(e){return!1}).on("mousedown","."+this.opt.css_drag,this.startDrag())},maxSelect:function(){this.setSelect([0,0,this.elw,this.elh])},nudge:function(e,t){var n=this.ui.selection,i=n.get();i.x+=e,i.x2+=e,i.y+=t,i.y2+=t,i.x<0?(i.x2=i.w,i.x=0):i.x2>this.elw&&(i.x2=this.elw,i.x=i.x2-i.w),i.y<0?(i.y2=i.h,i.y=0):i.y2>this.elh&&(i.y2=this.elh,i.y=i.y2-i.h),n.element.trigger("cropstart",[n,this.unscale(i)]),n.updateRaw(i,"move"),n.element.trigger("cropend",[n,this.unscale(i)])},refresh:function(){for(var e=0,t=this.ui.multi,n=t.length;e<n;e++)t[e].refresh()},blurAll:function(){for(var e=this.ui.multi,t=0;t<e.length;t++)e[t]!==sel&&n.push(e[t]),e[t].toBack()},scale:function(e){var t=this.opt.xscale,n=this.opt.yscale;return{x:e.x/t,y:e.y/n,x2:e.x2/t,y2:e.y2/n,w:e.w/t,h:e.h/n}},unscale:function(e){var t=this.opt.xscale,n=this.opt.yscale;return{x:e.x*t,y:e.y*n,x2:e.x2*t,y2:e.y2*n,w:e.w*t,h:e.h*n}},requestDelete:function(){if(this.ui.multi.length>1&&this.ui.selection.canDelete)return this.deleteSelection()},deleteSelection:function(){this.ui.selection&&(this.removeSelection(this.ui.selection),this.ui.multi.length&&this.ui.multi[0].focus(),this.ui.selection.refresh())},animateTo:function(e){return this.ui.selection&&this.ui.selection.animateTo(e),this},setSelect:function(e){return this.ui.selection&&this.ui.selection.update(t.wrapFromXywh(e)),this},startDrag:function(){var t=this;return function(n){var i=e(n.target),o=i.closest("."+t.opt.css_selection).data("selection"),r=i.data("ord");return t.container.trigger("cropstart",[o,t.unscale(o.get())]),o.startDrag(n,r),!1}},getContainerSize:function(){return[this.container.width(),this.container.height()]},resizeContainer:function(e,t){this.container.width(e).height(t),this.refresh()},setImage:function(t,n){var i=this,o=i.opt.imgsrc;if(!o)return!1;new e.JcropAnsel.component.ImageLoader(t,null,function(r,s){i.resizeContainer(r,s),o.src=t,e(o).width(r).height(s),i.applySizeConstraints(),i.refresh(),i.container.trigger("cropimage",[i,o]),"function"==typeof n&&n.call(i,r,s)})},update:function(e){this.ui.selection&&this.ui.selection.update(e)}}),e.fn.JcropAnsel=function(t,n){t=t||{};var i=this.eq(0).data("JcropAnsel"),o=Array.prototype.slice.call(arguments);return"api"==t?i:i&&"string"==typeof t?!!i[t]&&(o.shift(),i[t].apply(i,o),i):void this.each(function(){var i=e(this),o=i.data("JcropAnsel");return o?o.setOptions(t):(t.stageConstructor||(t.stageConstructor=e.JcropAnsel.stageConstructor),t.stageConstructor(this,t,function(t,o){var r=o.setSelect;r&&delete o.setSelect;var s=e.JcropAnsel.attach(t.element,o);"function"==typeof t.attach&&t.attach(s),i.data("JcropAnsel",s),r&&(s.newSelection(),s.setSelect(r)),"function"==typeof n&&n.call(s)})),this})};var b,T=function(e,t,n){var i,o,r,s={},a=t.documentElement,c="modernizr",l=t.createElement(c),h=l.style,u={}.toString,d=" -webkit- -moz- -o- -ms- ".split(" "),p="Webkit Moz O ms",g=p.split(" "),f=p.toLowerCase().split(" "),m="http://www.w3.org/2000/svg",v={},y=[],w=y.slice,x=function(e,n,i,o){var r,s,l,h,u=t.createElement("div"),d=t.body,p=d||t.createElement("body");if(parseInt(i,10))for(;i--;)(l=t.createElement("div")).id=o?o[i]:c+(i+1),u.appendChild(l);return r=["&#173;",'<style id="s',c,'">',e,"</style>"].join(""),u.id=c,(d?u:p).innerHTML+=r,p.appendChild(u),d||(p.style.background="",p.style.overflow="hidden",h=a.style.overflow,a.style.overflow="hidden",a.appendChild(p)),s=n(u,e),d?u.parentNode.removeChild(u):(p.parentNode.removeChild(p),a.style.overflow=h),!!s},S=(r={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},function(e,i){i=i||t.createElement(r[e]||"div");var o=(e="on"+e)in i;return o||(i.setAttribute||(i=t.createElement("div")),i.setAttribute&&i.removeAttribute&&(i.setAttribute(e,""),o=F(i[e],"function"),F(i[e],"undefined")||(i[e]=n),i.removeAttribute(e))),i=null,o}),C={}.hasOwnProperty;function A(e){h.cssText=e}function F(e,t){return typeof e===t}function b(e,t){for(var i in e){var o=e[i];if(!~(""+o).indexOf("-")&&h[o]!==n)return"pfx"!=t||o}return!1}function T(e,t,i){var o=e.charAt(0).toUpperCase()+e.slice(1),r=(e+" "+g.join(o+" ")+o).split(" ");return F(t,"string")||F(t,"undefined")?b(r,t):function(e,t,i){for(var o in e){var r=t[e[o]];if(r!==n)return!1===i?e[o]:F(r,"function")?r.bind(i||t):r}return!1}(r=(e+" "+f.join(o+" ")+o).split(" "),t,i)}for(var E in o=F(C,"undefined")||F(C.call,"undefined")?function(e,t){return t in e&&F(e.constructor.prototype[t],"undefined")}:function(e,t){return C.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=w.call(arguments,1),i=function(){if(this instanceof i){var o=function(){};o.prototype=t.prototype;var r=new o,s=t.apply(r,n.concat(w.call(arguments)));return Object(s)===s?s:r}return t.apply(e,n.concat(w.call(arguments)))};return i}),v.canvas=function(){var e=t.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},v.canvastext=function(){return!(!s.canvas||!F(t.createElement("canvas").getContext("2d").fillText,"function"))},v.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:x(["@media (",d.join("touch-enabled),("),c,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=9===e.offsetTop}),n},v.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},v.csstransforms=function(){return!!T("transform")},v.svg=function(){return!!t.createElementNS&&!!t.createElementNS(m,"svg").createSVGRect},v.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==m},v.svgclippaths=function(){return!!t.createElementNS&&/SVGClipPath/.test(u.call(t.createElementNS(m,"clipPath")))},v)o(v,E)&&(i=E.toLowerCase(),s[i]=v[E](),y.push((s[i]?"":"no-")+i));return s.addTest=function(e,t){if("object"==typeof e)for(var i in e)o(e,i)&&s.addTest(i,e[i]);else{if(e=e.toLowerCase(),s[e]!==n)return s;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(a.className+=" "+(t?"":"no-")+e),s[e]=t}return s},A(""),l=null,s._version="2.7.1",s._prefixes=d,s._domPrefixes=f,s._cssomPrefixes=g,s.hasEvent=S,s.testProp=function(e){return b([e])},s.testAllProps=T,s.testStyles=x,s}(window,window.document);(b=new Image).onerror=function(){T.addTest("datauri",function(){return!1})},b.onload=function(){T.addTest("datauri",function(){return 1==b.width&&1==b.height})},b.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",e.JcropAnsel=t,e.JcropAnsel.supportsCanvas=T.canvas,e.JcropAnsel.supportsCanvasText=T.canvastext,e.JcropAnsel.supportsDragAndDrop=T.draganddrop,e.JcropAnsel.supportsDataURI=T.datauri,e.JcropAnsel.supportsSVG=T.svg,e.JcropAnsel.supportsInlineSVG=T.inlinesvg,e.JcropAnsel.supportsSVGClipPaths=T.svgclippaths,e.JcropAnsel.supportsCSSTransforms=T.csstransforms,e.JcropAnsel.supportsTouch=T.touch}(jQuery),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},runFabController(window[window.FABNAMESPACE]),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";var t=[],n=function(e){var n;return"object"!=typeof e&&(e={}),(n=function(n){var i,o=this;for(var r in o.guid=(i=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i(),t.push(o.guid),o.properties={},o.propertyTypes=e,o.changeEvents={},o.propertyTypes)o.propertyTypes.hasOwnProperty(r)&&(o.changeEvents[r]={});for(var s in n)n.hasOwnProperty(s)&&void 0!==o.propertyTypes[s]&&(o.properties[s]=n[s])}).prototype={get:function(e){var t=this;return t.properties[e]?"int"===t.propertyTypes[e]?parseInt(t.properties[e]):"float"===t.propertyTypes[e]?parseFloat(t.properties[e]):"string"===t.propertyTypes[e]?String(t.properties[e]):"bool"===t.propertyTypes[e]?!0===t.properties[e]:"array"===t.propertyTypes[e]?t.properties[e].constructor===Array?t.properties[e]:[]:"object"===t.propertyTypes[e]?t.properties[e].constructor===Object?t.properties[e]:{}:null:"int"===t.propertyTypes[e]||"float"===t.propertyTypes[e]?0:"string"===t.propertyTypes[e]?"":"bool"!==t.propertyTypes[e]&&("array"===t.propertyTypes[e]?[]:"object"===t.propertyTypes[e]?{}:null)},set:function(e,t){var n,i=this,o=!1,r=i.properties[e];if("int"===i.propertyTypes[e]?(i.properties[e]=parseInt(t),o=!0):"float"===i.propertyTypes[e]?(i.properties[e]=parseFloat(t),o=!0):"string"===i.propertyTypes[e]?(i.properties[e]=String(t),o=!0):"bool"===i.propertyTypes[e]?(i.properties[e]=!0===t||"true"===t||"yes"===t||"y"===t,o=!0):"array"===i.propertyTypes[e]?t.constructor===Array&&(i.properties[e]=t,o=!0):"object"===i.propertyTypes[e]&&t.constructor===Object&&(i.properties[e]=t,o=!0),o&&r!==i.properties[e]&&void 0!==i.changeEvents[e])for(var s in n=[i.properties[e],r],i.changeEvents[e])i.changeEvents[e][s].forEach(function(e){e.apply(e,n)})},onChange:function(e,t){var n=this,i=e.split(".");void 0!==n.propertyTypes[i[0]]&&(void 0===i[1]?(void 0===n.changeEvents[i[0]].noNameSpace&&(n.changeEvents[i[0]].noNameSpace=[]),n.changeEvents[i[0]].noNameSpace.push(t)):(void 0===n.changeEvents[i[0]][i[1]]&&(n.changeEvents[i[0]][i[1]]=[]),n.changeEvents[i[0]][i[1]].push(t)))},offChange:function(e){var t=e.split(".");void 0===t[1]?this.changeEvents[t[0]]={}:delete this.changeEvents[t[0]][t[1]]}},n};e.model={make:function(){return n.apply(n,arguments)},validateGuid:function(e){return t.indexOf(e)>-1}}}(window[window.FABNAMESPACE]),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";window[window.FABNAMESPACE].uuid={make:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}}(),window.ANSEL=window.ANSEL||{},runField(window.ANSEL),window.ANSEL=window.ANSEL||{},runFieldDropUploader(window.ANSEL),window.ANSEL=window.ANSEL||{},runImage(window.ANSEL),window.ANSEL=window.ANSEL||{},runMaxTracker(window.ANSEL),window.ANSEL=window.ANSEL||{},runMinTracker(window.ANSEL),window.ANSEL=window.ANSEL||{},runNotification(window.ANSEL),window.ANSEL=window.ANSEL||{},runNotifications(window.ANSEL),window.ANSEL=window.ANSEL||{},runMain(window.ANSEL);
//# sourceMappingURL=script.min.js.map