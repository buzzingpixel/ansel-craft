function runFabController(e){"use strict";if(void 0!==window.jQuery){var n=window.jQuery,o={},t=[],i=function(t,i){var r;return"object"==typeof t?(i=t,t=null):"string"!=typeof t&&(i={},t=null),r=function(o){var t,r,s=this,a=$.extend(!0,{},i);for(t in a)a.hasOwnProperty(t)&&(s[t]=a[t]);if("object"==typeof o)for(t in o)o.hasOwnProperty(t)&&(s[t]=o[t]);if(s.el?"string"==typeof s.el?(s.$el=$(s.el),s.el=s.$el.get(0)):s.el instanceof n?(s.$el=s.el,s.el=s.$el.get(0)):s.el instanceof HTMLElement&&(s.$el=$(s.el)):(s.$el=$("<div></div>"),s.el=s.$el.get(0)),"object"==typeof s.model&&void 0!==e.model?e.model.validateGuid(s.model.guid)||(r=e.model.make(s.model),s.model=new r):void 0!==this.model&&(s.model=null),"function"==typeof s.init&&(Array.prototype.shift.apply(arguments),s.init.apply(s,arguments)),"object"==typeof s.events)for(t in s.events)s.events.hasOwnProperty(t)&&"function"==typeof s.events[t]&&function(e,n){e[1]?s.$el.on(e[0],e[1],function(){n.apply(s,arguments)}):s.$el.on(e[0],function(){n.apply(s,arguments)})}(t.split(" "),s.events[t])},t&&(o[t]=r),r};e.controller={make:function(){return i.apply(i,arguments)},construct:function(e){var n;return"function"!=typeof o[e]?null:(n=new(Function.prototype.bind.apply(o[e],arguments)),t.push(n),n)}}}else setTimeout(function(){runFabController(e)},10)}function runField(e){"use strict";var n,o;window.jQuery&&e.controller&&e.model?(n=e.model.make({dragStart:"int",dragEnd:"int",drop:"int",uploadStart:"int",uploadComplete:"int",notificationChange:"int"}),o=e.model.make({uploadKey:"string",uploadActionUrl:"string",csrfToken:"string",elementId:"int",fieldId:"int",fieldName:"string",uploadLocation:"int",uploadFolderId:"int",saveLocation:"int",saveFolderId:"int",minQty:"int",maxQty:"int",preventUploadOverMax:"bool",quality:"int",forceJpg:"bool",retinaMode:"bool",minWidth:"int",minHeight:"int",maxWidth:"int",maxHeight:"int",ratio:"string",ratioWidth:"int",ratioHeight:"int",showTitle:"bool",requireTitle:"int",titleLabel:"string",showCaption:"bool",requireCaption:"bool",captionLabel:"string",showCover:"bool",requireCover:"bool",coverLabel:"string"}),e.controller.make("Field",{sharedModel:null,eventTriggers:null,commonStorage:{sorter:null},init:function(){var o,t=this;t.eventTriggers=new n,(o={el:t.$el,sharedModel:t.populateSharedModel(),eventTriggers:t.eventTriggers}).commonObjSend=o,t.initSorting(),e.controller.construct("Notifications",o),e.controller.construct("FieldDropUploader",o)},populateSharedModel:function(){var e=this,n=e.$el.data("settings"),t={uploadKey:e.$el.data("uploadKey"),uploadActionUrl:e.$el.data("uploadActionUrl"),csrfToken:e.$el.data("csrfToken")};for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return e.sharedModel=new o(t),e.sharedModel},initSorting:function(){var e=this;e.commonStorage.sorter=new window.Garnish.DragSort({container:e.$el.find(".JSAnselField__ImagesHolder"),axis:null,collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.6,onSortChange:function(){console.log("onSortChange")},onDragStop:function(){console.log("onDragStop")}}),e.$el.find(".JSAnselField__ImagesHolder").find(".JSAnselField__Image").each(function(){e.commonStorage.sorter.addItems($(this))})}})):setTimeout(function(){runField(e)},10)}function runFieldDropUploader(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("FieldDropUploader",{sharedModel:null,eventTriggers:null,commonObjSend:null,uploadFiles:{},uploadInProgress:!1,init:function(){var n=this,o=n.$el;o.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){o.addClass("AnselField--DragInProgress"),n.eventTriggers.set("dragStart",n.eventTriggers.get("dragStart")+1)}).on("dragleave dragend drop",function(){o.removeClass("AnselField--DragInProgress"),n.eventTriggers.set("dragEnd",n.eventTriggers.get("dragEnd")+1)}).on("drop",function(t){var i=t.originalEvent.dataTransfer.files;o.addClass("AnselField--IsUploading"),n.eventTriggers.set("drop",n.eventTriggers.get("drop")+1),$.each(i,function(o,t){n.uploadFiles[e.uuid.make()]=t})}),n.processUploadFilesWatcher()},processUploadFilesWatcher:function(){var e=this;e.$el.hasClass("AnselField--IsUploading")&&!Object.keys(e.uploadFiles).length&&(e.$el.removeClass("AnselField--IsUploading"),e.eventTriggers.set("uploadComplete",e.eventTriggers.get("uploadComplete")+1)),!e.uploadInProgress&&Object.keys(e.uploadFiles).length?(e.eventTriggers.set("uploadStart",e.eventTriggers.get("uploadStart")+1),e.uploadInProgress=!0,e.processUploadFile(Object.keys(e.uploadFiles)[0]),setTimeout(function(){e.processUploadFilesWatcher()},500)):setTimeout(function(){e.processUploadFilesWatcher()},500)},processUploadFile:function(n){var o=this,t=o.uploadFiles[n],i=new FormData;i.append("CRAFT_CSRF_TOKEN",o.sharedModel.get("csrfToken")),i.append("uploadKey",o.sharedModel.get("uploadKey")),i.append("file",t,t.name),i.append("minWidth",o.sharedModel.get("minWidth")),i.append("minHeight",o.sharedModel.get("minHeight")),$.ajax({url:o.sharedModel.get("uploadActionUrl"),type:"post",data:i,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){delete o.uploadFiles[n],o.uploadInProgress=!1},success:function(n){n.success?console.log("success"):e.controller.construct("Notification",{el:o.$el,eventTriggers:o.eventTriggers,error:!0,heading:t.name,message:n.message,destroyEvents:["dragStart"]})},error:function(){e.controller.construct("Notification",{el:o.$el,eventTriggers:o.eventTriggers,error:!0,heading:t.name,message:"An unknown error occurred while uploading this file",destroyEvents:["dragStart"]})}})}}):setTimeout(function(){runFieldDropUploader(e)},10)}function runNotification(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Notification",{eventTriggers:null,error:!1,heading:"",message:"",destroyEvents:[],$notificationList:null,$line:null,init:function(){var e=this,n="";e.$notificationList=e.$el.find(".JSAnselField__Notifications"),e.$line=$('<li class="AnselField__Notification JSAnselField__Notification"></li>'),e.heading&&(n+="<strong>"+e.heading+"</strong>: "),n+=e.message,e.$line.html(n),e.error&&e.$line.addClass("AnselField__Notification--IsError"),e.$line.appendTo(e.$notificationList),e.eventTriggers.set("notificationChange",e.eventTriggers.get("notificationChange")+1),e.destroyEvents.forEach(function(n){e.eventTriggers.onChange(n+"."+e.uuid,function(){e.destroy()})})},destroy:function(){var e=this;e.$line.remove(),e.destroyEvents.forEach(function(n){e.eventTriggers.offChange(n+"."+e.uuid)}),e.eventTriggers.set("notificationChange",e.eventTriggers.get("notificationChange")+1)}}):setTimeout(function(){runNotification(e)},10)}function runNotifications(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Notifications",{eventTriggers:null,$notifications:null,init:function(){var e=this;e.$notifications=e.$el.find(".JSAnselField__Notifications"),e.eventTriggers.onChange("notificationChange",function(){setTimeout(function(){e.triggerChange()},500)})},triggerChange:function(){this.$notifications.find(".JSAnselField__Notification").length?this.$notifications.addClass("AnselField__Notifications--HasNotifications"):this.$notifications.removeClass("AnselField__Notifications--HasNotifications")}}):setTimeout(function(){runNotifications(e)},10)}function runMain(e){"use strict";window.jQuery&&e.controller&&e.model?$(".JSAnselField").each(function(){e.controller.construct("Field",{el:this})}):setTimeout(function(){runMain(e)},10)}window.FABNAMESPACE="ANSEL",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},runFabController(window[window.FABNAMESPACE]),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";var n=[],o=function(e){var o;return"object"!=typeof e&&(e={}),(o=function(o){var t,i=this;for(var r in i.guid=(t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t(),n.push(i.guid),i.properties={},i.propertyTypes=e,i.changeEvents={},i.propertyTypes)i.propertyTypes.hasOwnProperty(r)&&(i.changeEvents[r]={});for(var s in o)o.hasOwnProperty(s)&&void 0!==i.propertyTypes[s]&&(i.properties[s]=o[s])}).prototype={get:function(e){var n=this;return n.properties[e]?"int"===n.propertyTypes[e]?parseInt(n.properties[e]):"float"===n.propertyTypes[e]?parseFloat(n.properties[e]):"string"===n.propertyTypes[e]?String(n.properties[e]):"bool"===n.propertyTypes[e]?!0===n.properties[e]:"array"===n.propertyTypes[e]?n.properties[e].constructor===Array?n.properties[e]:[]:"object"===n.propertyTypes[e]?n.properties[e].constructor===Object?n.properties[e]:{}:null:"int"===n.propertyTypes[e]||"float"===n.propertyTypes[e]?0:"string"===n.propertyTypes[e]?"":"bool"!==n.propertyTypes[e]&&("array"===n.propertyTypes[e]?[]:"object"===n.propertyTypes[e]?{}:null)},set:function(e,n){var o,t=this,i=!1,r=t.properties[e];if("int"===t.propertyTypes[e]?(t.properties[e]=parseInt(n),i=!0):"float"===t.propertyTypes[e]?(t.properties[e]=parseFloat(n),i=!0):"string"===t.propertyTypes[e]?(t.properties[e]=String(n),i=!0):"bool"===t.propertyTypes[e]?(t.properties[e]=!0===n||"true"===n||"yes"===n||"y"===n,i=!0):"array"===t.propertyTypes[e]?n.constructor===Array&&(t.properties[e]=n,i=!0):"object"===t.propertyTypes[e]&&n.constructor===Object&&(t.properties[e]=n,i=!0),i&&r!==t.properties[e]&&void 0!==t.changeEvents[e])for(var s in o=[t.properties[e],r],t.changeEvents[e])t.changeEvents[e][s].forEach(function(e){e.apply(e,o)})},onChange:function(e,n){var o=this,t=e.split(".");void 0!==o.propertyTypes[t[0]]&&(void 0===t[1]?(void 0===o.changeEvents[t[0]].noNameSpace&&(o.changeEvents[t[0]].noNameSpace=[]),o.changeEvents[t[0]].noNameSpace.push(n)):(void 0===o.changeEvents[t[0]][t[1]]&&(o.changeEvents[t[0]][t[1]]=[]),o.changeEvents[t[0]][t[1]].push(n)))},offChange:function(e){var n=e.split(".");void 0===n[1]?this.changeEvents[n[0]]={}:delete this.changeEvents[n[0]][n[1]]}},o};e.model={make:function(){return o.apply(o,arguments)},validateGuid:function(e){return n.indexOf(e)>-1}}}(window[window.FABNAMESPACE]),window.ANSEL=window.ANSEL||{},runField(window.ANSEL),window.ANSEL=window.ANSEL||{},runFieldDropUploader(window.ANSEL),window.ANSEL=window.ANSEL||{},runNotification(window.ANSEL),window.ANSEL=window.ANSEL||{},runNotifications(window.ANSEL),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";window[window.FABNAMESPACE].uuid={make:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}}(),window.ANSEL=window.ANSEL||{},runMain(window.ANSEL);
//# sourceMappingURL=script.min.js.map