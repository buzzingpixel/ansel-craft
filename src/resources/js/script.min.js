function runFabController(e){"use strict";if(void 0!==window.jQuery){var t=window.jQuery,n={},o=[],i=function(o,i){var r;return"object"==typeof o?(i=o,o=null):"string"!=typeof o&&(i={},o=null),r=function(n){var o,r,a=this,s=$.extend(!0,{},i);for(o in s)s.hasOwnProperty(o)&&(a[o]=s[o]);if("object"==typeof n)for(o in n)n.hasOwnProperty(o)&&(a[o]=n[o]);if(a.el?"string"==typeof a.el?(a.$el=$(a.el),a.el=a.$el.get(0)):a.el instanceof t?(a.$el=a.el,a.el=a.$el.get(0)):a.el instanceof HTMLElement&&(a.$el=$(a.el)):(a.$el=$("<div></div>"),a.el=a.$el.get(0)),"object"==typeof a.model&&void 0!==e.model?e.model.validateGuid(a.model.guid)||(r=e.model.make(a.model),a.model=new r):void 0!==this.model&&(a.model=null),"function"==typeof a.init&&(Array.prototype.shift.apply(arguments),a.init.apply(a,arguments)),"object"==typeof a.events)for(o in a.events)a.events.hasOwnProperty(o)&&"function"==typeof a.events[o]&&function(e,t){e[1]?a.$el.on(e[0],e[1],function(){t.apply(a,arguments)}):a.$el.on(e[0],function(){t.apply(a,arguments)})}(o.split(" "),a.events[o])},o&&(n[o]=r),r};e.controller={make:function(){return i.apply(i,arguments)},construct:function(e){var t;return"function"!=typeof n[e]?null:(t=new(Function.prototype.bind.apply(n[e],arguments)),o.push(t),t)}}}else setTimeout(function(){runFabController(e)},10)}function runCraftFileChooser(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("CraftFileChooser",{commonStorage:{},events:{click:function(){this.openModal()}},openModal:function(){var e,t=this;e=window.Craft.createElementSelectorModal("craft\\elements\\Asset",{criteria:{kind:"image"},multiSelect:!0,sources:["folder:"+t.commonStorage.sharedModel.get("uploadFolderId")],onSelect:function(n){for(var o in $(".modal-shade").remove(),e.destroy(),n)n.hasOwnProperty(o)&&t.addFile(n[o])}})},addFile:function(t){var n=this,o=new Image,i=n.commonStorage.sharedModel.get("minWidth"),r=n.commonStorage.sharedModel.get("minHeight");o.onload=function(){var a,s,l="";if(i&&o.width<i||r&&o.height<r)return i&&r?l="Field requires images to be at least "+i+"px wide and "+r+"px tall.":i?l="Field requires images to be at least "+i+"px wide.":r&&(l="Field requires images to be at least "+r+"px tall."),void e.controller.construct("Notification",{commonStorage:n.commonStorage,error:!0,message:l,destroyEvents:["dragStart","imageControllerUuids"]});s=(a=$(n.commonStorage.imageTemplate)).find(".JSAnselField__ImageTag"),a.find(".JSAnselField__Input--OriginalAssetId").val(t.id),s.on("load",function(){setTimeout(function(){e.controller.construct("Image",{commonStorage:n.commonStorage,insertImage:!0,$image:a})},100)}),a.data("originalAssetId",t.id),s.attr("src",t.url)},o.src=t.url}}):setTimeout(function(){runCraftFileChooser(e)},10)}function runField(e){"use strict";var t,n;window.jQuery&&e.controller&&e.model?(t=e.model.make({dragStart:"int",dragEnd:"int",drop:"int",uploadStart:"int",uploadComplete:"int",notificationChange:"int",activeCover:"string",openFieldEditor:"string",orderChange:"int",imageControllerUuids:"array"}),n=e.model.make({uploadKey:"string",uploadActionUrl:"string",csrfToken:"string",elementId:"int",fieldId:"int",fieldName:"string",uploadLocation:"int",uploadFolderId:"int",saveLocation:"int",saveFolderId:"int",minQty:"int",maxQty:"int",preventUploadOverMax:"bool",quality:"int",forceJpg:"bool",retinaMode:"bool",minWidth:"int",minHeight:"int",maxWidth:"int",maxHeight:"int",ratio:"string",ratioWidth:"int",ratioHeight:"int",showTitle:"bool",requireTitle:"int",titleLabel:"string",showCaption:"bool",requireCaption:"bool",captionLabel:"string",showCover:"bool",requireCover:"bool",coverLabel:"string"}),e.controller.make("Field",{commonStorage:{el:null,$el:null,sharedModel:null,eventTriggers:null,sorter:null,imageTemplate:null,$imagesHolder:null,$notificationList:null},init:function(){var t,n=this;n.setUp(),t={commonStorage:n.commonStorage},e.controller.construct("Notifications",t),e.controller.construct("FieldDropUploader",t),e.controller.construct("MaxTracker",t),e.controller.construct("MinTracker",t),e.controller.construct("CraftFileChooser",{el:".JSAnselField__SelectImageButton",commonStorage:n.commonStorage}),n.$el.find(".JSAnselField__Image").each(function(){e.controller.construct("Image",{commonStorage:n.commonStorage,$image:$(this)})})},setUp:function(){var e=this,n=e.$el.find(".JSAnselField__ImageTemplate").html(),o=e.$el.find(".JSAnselField__ImagesHolder");e.commonStorage={el:e.el,$el:e.$el,sharedModel:e.populateSharedModel(),eventTriggers:new t,sorter:e.setUpSorting(o),imageTemplate:n,$imagesHolder:o,$notificationList:e.$el.find(".JSAnselField__Notifications"),fieldsModalHtml:e.$el.find(".JSAnselField__ModalTemplate").html(),cropTableTemplate:e.$el.find(".JSAnselField__CropTableTemplate").html(),translateActionUrl:e.$el.data("translateActionUrl")}},populateSharedModel:function(){var e=this.$el.data("settings"),t={uploadKey:this.$el.data("uploadKey"),uploadActionUrl:this.$el.data("uploadActionUrl"),csrfToken:this.$el.data("csrfToken")};for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return new n(t)},setUpSorting:function(e){var t=this;return new window.Garnish.DragSort({container:e,axis:null,collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.6,onSortChange:function(){t.commonStorage.eventTriggers.set("orderChange",t.commonStorage.eventTriggers.get("orderChange")+1)},onDragStop:function(){t.commonStorage.eventTriggers.set("orderChange",t.commonStorage.eventTriggers.get("orderChange")+1)}})}})):setTimeout(function(){runField(e)},10)}function runFieldDropUploader(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("FieldDropUploader",{commonStorage:{},uploadFiles:{},uploadInProgress:!1,init:function(){var t=this,n=t.commonStorage.$el;n.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){n.addClass("AnselField--DragInProgress"),t.commonStorage.eventTriggers.set("dragStart",t.commonStorage.eventTriggers.get("dragStart")+1)}).on("dragleave dragend drop",function(){n.removeClass("AnselField--DragInProgress"),t.commonStorage.eventTriggers.set("dragEnd",t.commonStorage.eventTriggers.get("dragEnd")+1)}).on("drop",function(o){var i=o.originalEvent.dataTransfer.files;n.addClass("AnselField--IsUploading"),t.commonStorage.eventTriggers.set("drop",t.commonStorage.eventTriggers.get("drop")+1),$.each(i,function(n,o){t.uploadFiles[e.uuid.make()]=o})}),t.processUploadFilesWatcher()},processUploadFilesWatcher:function(){var t=this,n=t.commonStorage.sharedModel.get("maxQty"),o=n>1?"images":"image",i=t.commonStorage.eventTriggers.get("imageControllerUuids").length,r=Object.keys(t.uploadFiles).length;e.imagesBeingUploaded=r,t.commonStorage.$el.hasClass("AnselField--IsUploading")&&!r&&(t.commonStorage.$el.removeClass("AnselField--IsUploading"),t.commonStorage.eventTriggers.set("uploadComplete",t.commonStorage.eventTriggers.get("uploadComplete")+1)),r&&t.commonStorage.sharedModel.get("preventUploadOverMax")&&i>=n&&(e.controller.construct("Notification",{commonStorage:t.commonStorage,message:"This field is limited to "+n+" "+o+" and does not allow image uploads beyond that quantity",destroyEvents:["dragStart","imageControllerUuids"]}),t.uploadFiles={}),!t.uploadInProgress&&r?(t.commonStorage.eventTriggers.set("uploadStart",t.commonStorage.eventTriggers.get("uploadStart")+1),t.uploadInProgress=!0,t.processUploadFile(Object.keys(t.uploadFiles)[0]),setTimeout(function(){t.processUploadFilesWatcher()},500)):setTimeout(function(){t.processUploadFilesWatcher()},500)},processUploadFile:function(t){var n=this,o=n.uploadFiles[t],i=new FormData;i.append("CRAFT_CSRF_TOKEN",n.commonStorage.sharedModel.get("csrfToken")),i.append("uploadKey",n.commonStorage.sharedModel.get("uploadKey")),i.append("file",o,o.name),i.append("minWidth",n.commonStorage.sharedModel.get("minWidth")),i.append("minHeight",n.commonStorage.sharedModel.get("minHeight")),$.ajax({url:n.commonStorage.sharedModel.get("uploadActionUrl"),type:"post",data:i,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){delete n.uploadFiles[t],n.uploadInProgress=!1},success:function(t){t.success?e.controller.construct("Image",{commonStorage:n.commonStorage,base64Image:t.file.base64,cacheFile:t.file.cacheFile,fileName:o.name}):e.controller.construct("Notification",{commonStorage:n.commonStorage,error:!0,heading:o.name,message:t.message,destroyEvents:["dragStart"]})},error:function(){e.controller.construct("Notification",{commonStorage:n.commonStorage,error:!0,heading:o.name,message:"An unknown error occurred while uploading this file",destroyEvents:["dragStart"]})}})}}):setTimeout(function(){runFieldDropUploader(e)},10)}function runImage(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Image",{commonStorage:{},setFromTemplate:!1,insertImage:!1,$image:null,$imageTag:null,$fieldsModal:null,originalAssetId:null,imageSrc:null,base64Image:null,cacheFile:null,fileName:null,uuid:null,model:{isOverAllowed:"bool",runCrop:"int",coords:"object",imageSave:"int",imageLoaded:"bool"},init:function(){var e=this;e.setUp(),e.setUpRowId(),e.initFieldEditor(),e.watchOpenFieldEditor(),e.watchForCoverChange(),e.watchForOrderChange(),e.watchForRemove(),e.setUpCrop()},setUp:function(){var t=this,n=t.commonStorage.eventTriggers.get("imageControllerUuids").slice(0);t.setFromTemplate=!t.$image,t.uuid=e.uuid.make(),n.push(t.uuid),t.commonStorage.eventTriggers.set("imageControllerUuids",n),t.setFromTemplate?t.$image=$(t.commonStorage.imageTemplate):t.originalAssetId=parseInt(t.$image.data("originalAssetId")),t.$image.data("jsUuid",t.uuid),t.$imageTag=t.$image.find(".JSAnselField__ImageTag"),t.base64Image&&t.cacheFile&&t.fileName?(t.$image.find(".JSAnselField__Input--CacheFile").val(t.cacheFile),t.$image.find(".JSAnselField__Input--FileName").val(t.fileName),t.$imageTag.attr("src",t.base64Image),t.base64Image=null):t.imageSrc&&t.$imageTag.attr("src",t.imageSrc),(t.setFromTemplate||t.insertImage)&&t.commonStorage.$imagesHolder.append(t.$image),t.commonStorage.sorter.addItems(t.$image),t.setFromTemplate||t.model.set("coords",{h:parseInt(t.$image.find(".JSAnselField__Input--Height").val()),w:parseInt(t.$image.find(".JSAnselField__Input--Width").val()),x:parseInt(t.$image.find(".JSAnselField__Input--X").val()),y:parseInt(t.$image.find(".JSAnselField__Input--Y").val())}),t.model.onChange("imageSave",function(){t.processImage()})},setUpRowId:function(){var e=this,t=e.$image.find(".JSAnselField__Input"),n=e.$image.data("id");e.$image.data("id",e.uuid).attr("data-id",e.uuid),t.each(function(){var t=$(this),o=t.attr("name");o=o.replace("anselRowId"+n,"anselRowId"+e.uuid),t.attr("name",o)})},initFieldEditor:function(){var e=this;e.$image.find(".JSAnselField__ImageIconEdit").on("click."+e.uuid,function(){e.$fieldsModal=$(e.commonStorage.fieldsModalHtml),e.openFieldEditor()})},openFieldEditor:function(){this.$fieldsModal=$(this.commonStorage.fieldsModalHtml),this._openFieldEditor()},_openFieldEditor:function(){var e=this,t=e.$fieldsModal.find(".AnselField__FieldsModalCancel"),n=e.$fieldsModal.find(".AnselField__FieldsModalSave"),o=e.$fieldsModal.find(".AnselField__FieldsModalPrev"),i=e.$fieldsModal.find(".AnselField__FieldsModalNext"),r=e.$fieldsModal.find(".JSAnselField__FieldsModalPreviewImageTag"),a=e.$fieldsModal.find(".JSAnselField__FieldsModalBodyHeading"),s=new window.Garnish.Modal(e.$fieldsModal),l=e.$fieldsModal.find(".JSAnselField__FieldsModalTitle"),c=e.$image.find(".JSAnselField__Input--Title"),d=e.$fieldsModal.find(".JSAnselField__FieldsModalCaption"),u=e.$image.find(".JSAnselField__Input--Caption"),h=e.$fieldsModal.find(".JSAnselField__FieldsModalCover").find(".lightswitch"),g=h.find(":input"),p=e.$image.find(".JSAnselField__Input--Cover"),m=e.$image.prev(".JSAnselField__Image"),f=e.$image.next(".JSAnselField__Image"),v=e.$fieldsModal.find(".AnselField__FieldsModalFooterSecondaryButtons");function w(){c.val(""),u.val(""),p.val(""),c.val(l.val()),u.val(d.val()),p.val(g.val()),g.val()&&e.commonStorage.eventTriggers.set("activeCover",e.uuid)}function y(){s&&(s.hide(),s.destroy(),s=null)}r.attr("src",e.$imageTag.attr("src")),a.text(e.fileName),e.$fieldsModal.find(".lightswitch").lightswitch(),l.val(c.val()),d.val(u.val()),p.val()&&h.trigger("mousedown").trigger("mouseup"),t.on("click",function(){y()}),n.on("click",function(){w(),y()}),m.length?o.on("click",function(){w(),s.hide(),e.commonStorage.eventTriggers.set("openFieldEditor",""),setTimeout(function(){y(),e.commonStorage.eventTriggers.set("openFieldEditor",m.data("jsUuid"))},50)}):o.addClass("disabled"),f.length?i.on("click",function(){w(),s.hide(),e.commonStorage.eventTriggers.set("openFieldEditor",""),setTimeout(function(){y(),e.commonStorage.eventTriggers.set("openFieldEditor",f.data("jsUuid"))},50)}):i.addClass("disabled"),m.length||f.length||v.hide()},watchOpenFieldEditor:function(){var e=this;e.commonStorage.eventTriggers.onChange("openFieldEditor."+e.uuid,function(t){t===e.uuid&&setTimeout(function(){e.openFieldEditor()},50)})},watchForCoverChange:function(){var e=this;e.commonStorage.eventTriggers.onChange("activeCover."+e.uuid,function(t){t!==e.uuid&&e.$image.find(".JSAnselField__Input--Cover").val("")})},watchForOrderChange:function(){var e=this;function t(){var t=e.$image.prevAll(".JSAnselField__Image").length+1,n=e.commonStorage.sharedModel.get("maxQty");!n||t<=n?e.model.set("isOverAllowed",!1):e.model.set("isOverAllowed",!0)}e.model.onChange("isOverAllowed."+e.uuid,function(t){t?e.$image.addClass("AnselField__Image--IsOverMax"):e.$image.removeClass("AnselField__Image--IsOverMax")}),e.commonStorage.eventTriggers.onChange("orderChange."+e.uuid,function(){t()}),t()},watchForRemove:function(){var e=this;e.$image.find(".JSAnselField__ImageIconRemove").on("click."+e.uuid,function(){e.remove()})},setUpCrop:function(){var t=this;t.setFromTemplate||t.model.onChange("imageLoaded",function(){t.updateThumbImgPosition(t.model.get("coords")),setTimeout(function(){t.updateThumbImgPosition(t.model.get("coords"))},200),setTimeout(function(){t.updateThumbImgPosition(t.model.get("coords"))},400)}),t.anselCropController=e.controller.construct("ImageCrop",{model:t.model,commonStorage:t.commonStorage,$imageTag:t.$imageTag,setInitialCoords:t.setFromTemplate||t.insertImage}),t.$image.find(".JSAnselField__ImageIconCrop").on("click",function(){t.model.set("runCrop",t.model.get("runCrop")+1)}),t.model.onChange("coords",function(e){t.updateCoordsInputs(e),t.updateThumbImgPosition(e)})},updateCoordsInputs:function(e){var t=this;t.$image.find(".JSAnselField__Input--X").val(Math.floor(e.x)),t.$image.find(".JSAnselField__Input--Y").val(Math.floor(e.y)),t.$image.find(".JSAnselField__Input--Width").val(Math.min(e.w,t.anselCropController.imgWidth)),t.$image.find(".JSAnselField__Input--Height").val(Math.min(e.h,t.anselCropController.imgHeight))},updateThumbImgPosition:function(e){var t=e.w/e.h,n=Math.round(168/t),o=168/e.w,i=n/e.h,r=Math.round(o*this.anselCropController.imgWidth),a=Math.round(i*this.anselCropController.imgHeight),s=-1*Math.round(o*e.x),l=-1*Math.round(i*e.y);this.$image.find(".JSAnselField__ImageWrapperInner").css({height:n+"px",overflow:"hidden",position:"relative",width:"168px"}),this.$imageTag.css({height:a+"px",left:s+"px","max-width":"none",position:"absolute",top:l+"px",width:r+"px"})},remove:function(){var e=this,t=e.commonStorage.eventTriggers.get("imageControllerUuids").slice(0),n=e.$image.find(".JSAnselField__Input--Delete");console.log(n),e.$image.find(".JSAnselField__Input--Id").prependTo(e.commonStorage.$el),n.val("1"),n.prependTo(e.commonStorage.$el),e.anselCropController.destroy(),e.$image.find(".JSAnselField__ImageIconRemove").off("click."+e.uuid),e.commonStorage.eventTriggers.offChange("orderChange."+e.uuid),e.model.offChange("isOverAllowed."+e.uuid),e.commonStorage.eventTriggers.offChange("activeCover."+e.uuid),e.commonStorage.eventTriggers.offChange("openFieldEditor."+e.uuid),e.$image.find(".JSAnselField__ImageIconEdit").off("click."+e.uuid),e.commonStorage.sorter.removeItems(e.$image),e.$image.remove(),e.$imageTag=null,e.$image=null,e.$fieldsModal=null,e.base64Image=null,e.cacheFile=null,e.fileName=null,e.uuid=null,e.model=null,t.splice(t.indexOf(e.uuid),1),e.commonStorage.eventTriggers.set("imageControllerUuids",t)},processImageTimer:0,processImage:function(){var t=this;clearTimeout(t.processImageTimer),t.processImageTimer=setTimeout(function(){e.AnselGlobalImageQueue[t.uuid]={controller:t,coords:t.model.get("coords"),fileLocation:t.originalAssetId||t.cacheFile,fileLocationType:t.originalAssetId?"asset":"cacheFile",quality:t.commonStorage.sharedModel.get("quality"),maxWidth:t.commonStorage.sharedModel.get("maxWidth"),maxHeight:t.commonStorage.sharedModel.get("maxHeight"),forceJpg:t.commonStorage.sharedModel.get("forceJpg")}},500)},processImageCallback:function(e){var t=this;t.$image.find(".JSAnselField__Input--PreFileLocation").val(e.model.fileLocation),t.$image.find(".JSAnselField__Input--PreFileLocationType").val(e.model.fileLocationType),t.$image.find(".JSAnselField__Input--PreH").val(e.model.h),t.$image.find(".JSAnselField__Input--PreW").val(e.model.w),t.$image.find(".JSAnselField__Input--PreX").val(e.model.x),t.$image.find(".JSAnselField__Input--PreY").val(e.model.y),t.$image.find(".JSAnselField__Input--PreHighQualityImgCacheLocation").val(e.model.highQualityImgCacheLocation),t.$image.find(".JSAnselField__Input--PreStandardImgCacheLocation").val(e.model.standardImgCacheLocation),t.$image.find(".JSAnselField__Input--PreThumbImgCacheLocation").val(e.model.thumbImgCacheLocation),t.$image.find(".JSAnselField__Input--PreMaxHeight").val(e.model.maxHeight),t.$image.find(".JSAnselField__Input--PreMaxWidth").val(e.model.maxWidth)}}):setTimeout(function(){runImage(e)},10)}function runImageCrop(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("ImageCrop",{locked:!1,commonStorage:{},uuid:null,$imageTag:null,setInitialCoords:!0,model:{},$cropImage:null,$approveCropBtn:null,$cancelCropBtn:null,imgWidth:null,imgHeight:null,scale:null,prevCropValues:null,limitedWidth:0,limitedHeight:0,resizingInProgress:!1,setupInProgress:!1,Jcrop:null,JcropChangeTimeout:0,init:function(){var t=this;t.uuid=e.uuid.make(),t.$el=$(t.commonStorage.cropTableTemplate),t.el=t.$el.get(0),t.$cropImage=t.$el.find(".JSAnselCropTable__Img"),t.$approveCropBtn=t.$el.find(".JSAnselToolBar__Button--ApproveCrop"),t.$cancelCropBtn=t.$el.find(".JSAnselToolBar__Button--CancelCrop"),t.$cropImage.on("load",function(){t.$cropImage.off("load"),t.imgWidth=this.width,t.imgHeight=this.height,t.setInitialCoords&&t.setUpInitialCoords(),t.model.onChange("runCrop",function(){t.render()}),t.model.set("imageLoaded",!0)}),t.$cropImage.attr("src",t.$imageTag.attr("src"))},setUpInitialCoords:function(){var e=this,t={h:200,w:200,x:0,y:0},n=e.commonStorage.sharedModel.get("ratioWidth"),o=e.commonStorage.sharedModel.get("ratioHeight");n&&o?o/n<=e.imgHeight/e.imgWidth?(t.h=e.imgWidth*(o/n),t.y=(e.imgHeight-t.h)/2,t.x=0,t.w=e.imgWidth):(t.w=e.imgHeight*(n/o),t.x=(e.imgWidth-t.w)/2,t.y=0,t.h=e.imgHeight):(t.w=e.imgWidth,t.h=e.imgHeight),t.w=parseInt(t.w),t.h=parseInt(t.h),t.x=parseInt(t.x),t.y=parseInt(t.y),e.model.set("coords",t),setTimeout(function(){e.triggerSave()},200)},render:function(){var e=this;e.prevCropValues=e.model.get("coords"),$("body").append(e.$el),e.setUpCrop(),e.$approveCropBtn.on("click.approve-"+e.uuid,function(){e.closeCrop(),e.triggerSave()}),e.$cancelCropBtn.on("click.cancel-"+e.uuid,function(){e.closeCrop(),e.resetCropValues()}),e.setUpKeyBindings()},setUpCrop:function(){var e=this,t=e.model.get("coords"),n=e.commonStorage.sharedModel.get("ratioWidth"),o=e.commonStorage.sharedModel.get("ratioHeight"),i=e.commonStorage.sharedModel.get("minWidth"),r=e.commonStorage.sharedModel.get("minHeight"),a={onChange:function(t){e.locked||(t.w=parseInt(t.w),t.h=parseInt(t.h),t.x=parseInt(t.x),t.y=parseInt(t.y),e.jCropOnChange(t),e.model.set("coords",t))},bgColor:"black",bgOpacity:.5};e.locked=!1,e.Jcrop&&e.Jcrop.destroy(),e.setScale(),n&&o&&(a.aspectRatio=n/o,i&&!r?r=Math.floor(o*i/n):r&&!i&&(i=Math.floor(n*r/o))),(i||r)&&(a.minSize=[i?i*e.scale:0,r?r*e.scale:0]),a.setSelect=[t.x,t.y,t.w,t.h],e.$cropImage.css("width",e.imgWidth*e.scale),e.$cropImage.css("height",e.imgHeight*e.scale),a.boxWidth=e.imgWidth*e.scale,a.boxHeight=e.imgHeight*e.scale,a.xscale=e.scale,a.yscale=e.scale,e.$cropImage.JcropAnsel(a,function(){e.Jcrop=this,e.resizingInProgress=!1,setTimeout(function(){e.setupInProgress=!1},10)})},setScale:function(){var e,t,n=this,o=window.innerWidth,i=window.innerHeight,r=Math.max(o-80,.9*o),a=Math.max(i-140,.9*i);if(n.imgWidth>r||n.imgHeight>a)return e=r/n.imgWidth,t=a/n.imgHeight,void(n.scale=Math.round(100*Math.min(e,t))/100);n.scale=1},jCropOnChange:function(e){var t=this,n=t.commonStorage.sharedModel.get("minWidth")||0,o=t.commonStorage.sharedModel.get("minHeight")||0,i=t.commonStorage.sharedModel.get("maxWidth")||0,r=t.commonStorage.sharedModel.get("maxHeight")||0,a=t.limitedWidth||0,s=t.limitedHeight||0,l=t.model.get("coords"),c=!1,d=$("body");!t.resizingInProgress&&t.Jcrop||(c=!0),l&&l.w===e.w&&l.h===e.h&&l.y===e.y&&l.y2===e.y2&&l.x===e.x&&l.x2===e.x2&&(c=!0),t.model.set("coords",e),c||(i&&r&&(o&&e.w>i&&(o=e.w*o/i)>=t.imgHeight&&(t.limitedWidth=t.limitedWidth||e.w,t.limitedWidth=Math.min(e.w,t.limitedWidth),a=t.limitedWidth),n&&e.h>r&&(n=e.h*n/r)>=t.imgWidth&&(t.limitedHeight=t.limitedHeight||e.h,t.lmitedHeight=Math.min(e.h,t.limitedHeight),s=t.limitedHeight)),n=Math.min(t.imgWidth,n),o=Math.min(t.imgHeight,o),d.off("mouseup.JcropChange"),clearTimeout(t.JcropChangeTimeout),(n||o||a||s)&&(l.h<=e.h&&l.w<=e.w?(t.Jcrop.setOptions({minSize:[n*t.scale,o*t.scale],maxSize:[a,s]}),t.JcropChangeTimeout=setTimeout(function(){t.Jcrop.setOptions({minSize:[n?n*t.scale:0,o?o*t.scale:0]})},500)):d.on("mouseup.JcropChange",function(){t.Jcrop.setOptions({minSize:[n*t.scale,o*t.scale],maxSize:[a,s]}),t.JcropChangeTimeout=setTimeout(function(){t.Jcrop.setOptions({minSize:[n?n*t.scale:0,o?o*t.scale:0]})},500)})))},setUpKeyBindings:function(){var e=this,t=$(window),n=null;t.on("keydown.ansel-"+e.uuid,function(t){13===t.keyCode?(e.closeCrop(),e.triggerSave()):27===t.keyCode?(e.closeCrop(),e.resetCropValues()):n&&91===n&&83===t.keyCode&&(t.preventDefault(),e.closeCrop(),e.triggerSave()),n=91===t.keyCode?91:null}),t.on("keyup.ansel-"+e.uuid,function(e){91===e.keyCode&&(n=null)})},closeCrop:function(){var e=this,t=$(window);e.locked=!0,e.$el.detach(),e.$approveCropBtn.off("click.approve-"+e.uuid),e.$cancelCropBtn.off("click.cancel-"+e.uuid),t.off("keydown.ansel-"+e.uuid),t.off("keyup.ansel-"+e.uuid)},triggerSave:function(){this.model.set("imageSave",this.model.get("imageSave")+1)},resetCropValues:function(){var e=this;setTimeout(function(){e.model.set("coords",e.prevCropValues)},200)},destroy:function(){var e=this,t=$(window);e.$approveCropBtn.off("click.approve-"+e.uuid),e.$cancelCropBtn.off("click.cancel-"+e.uuid),t.off("keydown.ansel-"+e.uuid),t.off("keyup.ansel-"+e.uuid),clearTimeout(e.JcropChangeTimeout),e.$imageTag=null,e.$cropImage=null,e.$approveCropBtn=null,e.$cancelCropBtn=null,e.Jcrop=null,e.$el=null,e.el=null}}):setTimeout(function(){runImageCrop(e)},10)}function runImageProcessor(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("ImageProcessor",{inProgress:!1,csrfToken:null,uploadKey:null,processActionUrl:null,tries:{},init:function(){var e=$(".JSAnselField").eq(0);this.csrfToken=e.data("csrfToken"),this.uploadKey=e.data("uploadKey"),this.processActionUrl=e.data("processActionUrl"),this.watcher()},watcher:function(){var t=this,n=Object.keys(e.AnselGlobalImageQueue);t.inProgress||!n.length||e.imagesBeingUploaded>0?setTimeout(function(){t.watcher()},500):(t.inProgress=!0,t.processImageByKey(n[0]),setTimeout(function(){t.watcher()},500))},processImageByKey:function(t){var n=this,o=e.AnselGlobalImageQueue[t],i=new FormData;function r(){var i=n.tries[t]||0;delete e.AnselGlobalImageQueue[t],i>3||(i++,n.tries[t]=i,e.AnselGlobalImageQueue[t]=o)}i.append("CRAFT_CSRF_TOKEN",n.csrfToken),i.append("uploadKey",n.uploadKey),i.append("h",o.coords.h),i.append("w",o.coords.w),i.append("x",o.coords.x),i.append("y",o.coords.y),i.append("fileLocation",o.fileLocation),i.append("fileLocationType",o.fileLocationType),i.append("quality",o.quality),i.append("maxWidth",o.maxWidth),i.append("maxHeight",o.maxHeight),i.append("forceJpg",o.forceJpg),$.ajax({url:n.processActionUrl,type:"post",data:i,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){n.inProgress=!1},success:function(n){n.success?(delete e.AnselGlobalImageQueue[t],o.controller.processImageCallback(n)):r()},error:function(){r()}})}}):setTimeout(function(){runImageProcessor(e)},10)}function runMaxTracker(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("MaxTracker",{commonStorage:{},notification:null,model:{isOverMax:"bool",isAtMax:"bool"},init:function(){var e=this;e.model.onChange("isOverMax",function(t){t?e.setOver():e.removeOver()}),e.commonStorage.sharedModel.get("preventUploadOverMax")&&e.model.onChange("isAtMax",function(t){t?e.preventUploads():e.allowUploads()}),e.checkImageCount(),e.commonStorage.eventTriggers.onChange("imageControllerUuids",function(){e.checkImageCount()})},checkImageCount:function(){var e=this.commonStorage.eventTriggers.get("imageControllerUuids").length,t=this.commonStorage.sharedModel.get("maxQty");this.model.set("isAtMax",t&&e>=t),this.model.set("isOverMax",t&&e>t)},setOver:function(){var t=this.commonStorage.sharedModel.get("maxQty"),n=t>1?"images":"image";this.notification||(this.notification=e.controller.construct("Notification",{commonStorage:this.commonStorage,message:"This field is limited to "+t+" "+n+". All images uploaded beyond that will not be displayed."}))},removeOver:function(){this.notification&&(this.notification.destroy(),this.notification=null)},preventUploads:function(){var e=this.commonStorage.$el.find(".JSAnselField__DropImagesToUpload");(e=e.add(this.commonStorage.$el.find(".JSAnselField__SelectImage"))).hide()},allowUploads:function(){var e=this.commonStorage.$el.find(".JSAnselField__DropImagesToUpload");(e=e.add(this.commonStorage.$el.find(".JSAnselField__SelectImage"))).show()}}):setTimeout(function(){runMaxTracker(e)},10)}function runMinTracker(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("MinTracker",{commonStorage:{},notification:null,model:{isUnderMin:"bool"},init:function(){var e=this;e.model.onChange("isUnderMin",function(t){t?e.setUnder():e.removeUnder()}),e.checkImageCount(),e.commonStorage.eventTriggers.onChange("imageControllerUuids",function(){e.checkImageCount()})},checkImageCount:function(){var e=this.commonStorage.eventTriggers.get("imageControllerUuids").length,t=this.commonStorage.sharedModel.get("minQty");!t||e>=t?this.model.set("isUnderMin",!1):this.model.set("isUnderMin",!0)},setUnder:function(){var t=this.commonStorage.sharedModel.get("minQty"),n=t>1?"images":"image";this.notification||(this.notification=e.controller.construct("Notification",{commonStorage:this.commonStorage,message:"This field requires at least "+t+" "+n+"."}))},removeUnder:function(){this.notification&&(this.notification.destroy(),this.notification=null)}}):setTimeout(function(){runMinTracker(e)},10)}function runNotification(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Notification",{commonStorage:{},error:!1,heading:"",message:"",destroyEvents:[],$line:null,init:function(){var e=this,t=new FormData;t.append("CRAFT_CSRF_TOKEN",e.commonStorage.sharedModel.get("csrfToken")),t.append("toTranslate[heading]",e.heading),t.append("toTranslate[message]",e.message),$.ajax({url:e.commonStorage.translateActionUrl,type:"post",data:t,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(t){e.render(t.message,t.heading)},error:function(){e.render(e.message,e.heading)}})},render:function(e,t){var n=this,o="";n.$line=$('<li class="AnselField__Notification JSAnselField__Notification"></li>'),t&&(o+="<strong>"+t+"</strong>: "),o+=e,n.$line.html(o),n.error&&n.$line.addClass("AnselField__Notification--IsError"),n.$line.appendTo(n.commonStorage.$notificationList),n.commonStorage.eventTriggers.set("notificationChange",n.commonStorage.eventTriggers.get("notificationChange")+1),n.destroyEvents.forEach(function(e){n.commonStorage.eventTriggers.onChange(e+"."+n.uuid,function(){n.destroy()})})},destroy:function(){var e=this;e.$line.remove(),e.destroyEvents.forEach(function(t){e.commonStorage.eventTriggers.offChange(t+"."+e.uuid)}),e.commonStorage.eventTriggers.set("notificationChange",e.commonStorage.eventTriggers.get("notificationChange")+1)}}):setTimeout(function(){runNotification(e)},10)}function runNotifications(e){"use strict";window.jQuery&&e.controller&&e.model?e.controller.make("Notifications",{commonStorage:{},$notifications:null,init:function(){var e=this;e.commonStorage.eventTriggers.onChange("notificationChange",function(){setTimeout(function(){e.triggerChange()},500)})},triggerChange:function(){var e=this.commonStorage.$notificationList;e.find(".JSAnselField__Notification").length?e.addClass("AnselField__Notifications--HasNotifications"):e.removeClass("AnselField__Notifications--HasNotifications")}}):setTimeout(function(){runNotifications(e)},10)}function runMain(e){"use strict";window.jQuery&&e.controller&&e.model?(e.imagesBeingUploaded=0,e.AnselGlobalImageQueue={},e.controller.construct("ImageProcessor"),e.runInitOnFields=function(){$(".JSAnselField").each(function(){var t=$(this);t.data("anselInit")||(t.data("anselInit",!0),e.controller.construct("Field",{el:this}))})},e.runInitOnFields()):setTimeout(function(){runMain(e)},10)}window.FABNAMESPACE="ANSEL",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";var t=function(n,o){var i=navigator.userAgent.toLowerCase();this.opt=e.extend({},t.defaults,o||{}),this.container=e(n),this.opt.is_msie=/msie/.test(i),this.opt.is_ie_lt9=/msie [1-8]\./.test(i),this.container.addClass(this.opt.css_container),this.ui={},this.state=null,this.ui.multi=[],this.ui.selection=null,this.filter={},this.init(),this.setOptions(o),this.applySizeConstraints(),this.container.trigger("cropinit",this),this.opt.is_ie_lt9&&(this.opt.dragEventTarget=document.body)};e.extend(t,{component:{},filter:{},stage:{},registerComponent:function(e,n){t.component[e]=n},registerFilter:function(e,n){t.filter[e]=n},registerStageType:function(e,n){t.stage[e]=n},attach:function(t,n){return new e.JcropAnsel(t,n)},imgCopy:function(e){var t=new Image;return t.src=e.src,t},imageClone:function(n){return e.JcropAnsel.supportsCanvas?t.canvasClone(n):t.imgCopy(n)},canvasClone:function(t){var n=document.createElement("canvas"),o=n.getContext("2d");return e(n).width(t.width).height(t.height),n.width=t.naturalWidth,n.height=t.naturalHeight,o.drawImage(t,0,0,t.naturalWidth,t.naturalHeight),n},propagate:function(e,t,n){for(var o=0,i=e.length;o<i;o++)t.hasOwnProperty(e[o])&&(n[e[o]]=t[e[o]])},getLargestBox:function(e,t,n){return t/n>e?[n*e,n]:[t,t/e]},stageConstructor:function(n,o,i){var r=[];e.each(t.stage,function(e,t){r.push(t)}),r.sort(function(e,t){return e.priority-t.priority});for(var a=0,s=r.length;a<s;a++)if(r[a].isSupported(n,o)){r[a].create(n,o,function(e,t){"function"==typeof i&&i(e,t)});break}},supportsColorFade:function(){return e.fx.step.hasOwnProperty("backgroundColor")},wrapFromXywh:function(e){var t={x:e[0],y:e[1],w:e[2],h:e[3]};return t.x2=t.x+t.w,t.y2=t.y+t.h,t}});var o=function(){};e.extend(o,{isSupported:function(e,t){return!0},priority:100,create:function(e,t,n){var i=new o;i.element=e,n.call(this,i,t)},prototype:{attach:function(e){this.init(e),e.ui.stage=this},triggerEvent:function(t){return e(this.element).trigger(t),this},getElement:function(){return this.element}}}),t.registerStageType("Block",o);var i=function(){};i.prototype=new o,e.extend(i,{isSupported:function(e,t){if("IMG"==e.tagName)return!0},priority:90,create:function(t,n,o){e.JcropAnsel.component.ImageLoader.attach(t,function(r,a){var s=new i;s.element=e(t).wrap("<div />").parent(),s.element.width(r).height(a),s.imgsrc=t,"function"==typeof o&&o.call(this,s,n)})}}),t.registerStageType("Image",i);var r=function(){this.angle=0,this.scale=1,this.scaleMin=.2,this.scaleMax=1.25,this.offset=[0,0]};r.prototype=new i,e.extend(r,{isSupported:function(t,n){if(e.JcropAnsel.supportsCanvas&&"IMG"==t.tagName)return!0},priority:60,create:function(t,n,o){var i=e(t),a=e.extend({},n);e.JcropAnsel.component.ImageLoader.attach(t,function(e,n){var s=new r;i.hide(),s.createCanvas(t,e,n),i.before(s.element),s.imgsrc=t,a.imgsrc=t,"function"==typeof o&&(o(s,a),s.redraw())})}}),e.extend(r.prototype,{init:function(e){this.core=e},setOffset:function(e,t){return this.offset=[e,t],this},setAngle:function(e){return this.angle=e,this},setScale:function(e){return this.scale=this.boundScale(e),this},boundScale:function(e){return e<this.scaleMin?e=this.scaleMin:e>this.scaleMax&&(e=this.scaleMax),e},createCanvas:function(t,n,o){this.width=n,this.height=o,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=o,this.$canvas=e(this.canvas).width("100%").height("100%"),this.context=this.canvas.getContext("2d"),this.fillstyle="rgba(0,0,0,0)",this.element=this.$canvas.wrap("<div />").parent().width(n).height(o)},triggerEvent:function(e){return this.$canvas.trigger(e),this},clear:function(){return this.context.fillStyle=this.fillstyle,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this},redraw:function(){return this.context.save(),this.clear(),this.context.translate(parseInt(.5*this.width),parseInt(.5*this.height)),this.context.translate(this.offset[0]/this.core.opt.xscale,this.offset[1]/this.core.opt.yscale),this.context.rotate(this.angle*(Math.PI/180)),this.context.scale(this.scale,this.scale),this.context.translate(-parseInt(.5*this.width),-parseInt(.5*this.height)),this.context.drawImage(this.imgsrc,0,0,this.width,this.height),this.context.restore(),this.$canvas.trigger("cropredraw"),this},setFillStyle:function(e){return this.fillstyle=e,this}}),t.registerStageType("Canvas",r);var a=function(){this.minw=40,this.minh=40,this.maxw=0,this.maxh=0,this.core=null};e.extend(a.prototype,{tag:"backoff",priority:22,filter:function(e){var t=this.bound;return e.x<t.minx&&(e.x=t.minx,e.x2=e.w+e.x),e.y<t.miny&&(e.y=t.miny,e.y2=e.h+e.y),e.x2>t.maxx&&(e.x2=t.maxx,e.x=e.x2-e.w),e.y2>t.maxy&&(e.y2=t.maxy,e.y=e.y2-e.h),e},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.bound={minx:0+e.edge.w,miny:0+e.edge.n,maxx:this.elw+e.edge.e,maxy:this.elh+e.edge.s}}}),t.registerFilter("backoff",a);var s=function(){this.core=null};e.extend(s.prototype,{tag:"constrain",priority:5,filter:function(e,t){return"move"==t?(e.x<this.minx&&(e.x=this.minx,e.x2=e.w+e.x),e.y<this.miny&&(e.y=this.miny,e.y2=e.h+e.y),e.x2>this.maxx&&(e.x2=this.maxx,e.x=e.x2-e.w),e.y2>this.maxy&&(e.y2=this.maxy,e.y=e.y2-e.h)):(e.x<this.minx&&(e.x=this.minx),e.y<this.miny&&(e.y=this.miny),e.x2>this.maxx&&(e.x2=this.maxx),e.y2>this.maxy&&(e.y2=this.maxy)),e.w=e.x2-e.x,e.h=e.y2-e.y,e},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.minx=0+e.edge.w,this.miny=0+e.edge.n,this.maxx=this.elw+e.edge.e,this.maxy=this.elh+e.edge.s}}),t.registerFilter("constrain",s);var l=function(){this.core=null};e.extend(l.prototype,{tag:"extent",priority:12,offsetFromCorner:function(e,t,n){var o=t[0],i=t[1];switch(e){case"bl":return[n.x2-o,n.y,o,i];case"tl":return[n.x2-o,n.y2-i,o,i];case"br":return[n.x,n.y,o,i];case"tr":return[n.x,n.y2-i,o,i]}},getQuadrant:function(e){var t=e.opposite[0]-e.offsetx,n=e.opposite[1]-e.offsety;return t<0&&n<0?"br":t>=0&&n>=0?"tl":t<0&&n>=0?"tr":"bl"},filter:function(e,n,o){if("move"==n)return e;var i=e.w,r=e.h,a=o.state,s=this.limits,l=a?this.getQuadrant(a):"br";return s.minw&&i<s.minw&&(i=s.minw),s.minh&&r<s.minh&&(r=s.minh),s.maxw&&i>s.maxw&&(i=s.maxw),s.maxh&&r>s.maxh&&(r=s.maxh),i==e.w&&r==e.h?e:t.wrapFromXywh(this.offsetFromCorner(l,[i,r],e))},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.limits={minw:e.minSize[0],minh:e.minSize[1],maxw:e.maxSize[0],maxh:e.maxSize[1]}}}),t.registerFilter("extent",l);var c=function(){this.stepx=1,this.stepy=1,this.core=null};e.extend(c.prototype,{tag:"grid",priority:19,filter:function(e){var t={x:Math.round(e.x/this.stepx)*this.stepx,y:Math.round(e.y/this.stepy)*this.stepy,x2:Math.round(e.x2/this.stepx)*this.stepx,y2:Math.round(e.y2/this.stepy)*this.stepy};return t.w=t.x2-t.x,t.h=t.y2-t.y,t}}),t.registerFilter("grid",c);var d=function(){this.ratio=0,this.core=null};e.extend(d.prototype,{tag:"ratio",priority:15,offsetFromCorner:function(e,t,n){var o=t[0],i=t[1];switch(e){case"bl":return[n.x2-o,n.y,o,i];case"tl":return[n.x2-o,n.y2-i,o,i];case"br":return[n.x,n.y,o,i];case"tr":return[n.x,n.y2-i,o,i]}},getBoundRatio:function(e,n){var o=t.getLargestBox(this.ratio,e.w,e.h);return t.wrapFromXywh(this.offsetFromCorner(n,o,e))},getQuadrant:function(e){var t=e.opposite[0]-e.offsetx,n=e.opposite[1]-e.offsety;return t<0&&n<0?"br":t>=0&&n>=0?"tl":t<0&&n>=0?"tr":"bl"},filter:function(e,t,n){if(!this.ratio)return e;e.w,e.h;var o=n.state,i=o?this.getQuadrant(o):"br";if("move"==(t=t||"se"))return e;switch(t){case"n":e.x2=this.elw,e.w=e.x2-e.x,i="tr";break;case"s":e.x2=this.elw,e.w=e.x2-e.x,i="br";break;case"e":e.y2=this.elh,e.h=e.y2-e.y,i="br";break;case"w":e.y2=this.elh,e.h=e.y2-e.y,i="bl"}return this.getBoundRatio(e,i)},refresh:function(e){this.ratio=e.aspectRatio,this.elw=e.core.container.width(),this.elh=e.core.container.height()}}),t.registerFilter("ratio",d);var u=function(){this.core=null};e.extend(u.prototype,{tag:"round",priority:90,filter:function(e){var t={x:Math.round(e.x),y:Math.round(e.y),x2:Math.round(e.x2),y2:Math.round(e.y2)};return t.w=t.x2-t.x,t.h=t.y2-t.y,t}}),t.registerFilter("round",u);var h=function(e,t){this.color=t||"black",this.opacity=e||.5,this.core=null,this.shades={}};e.extend(h.prototype,{tag:"shader",fade:!0,fadeEasing:"swing",fadeSpeed:320,priority:95,init:function(){var t=this;t.attached||(t.visible=!1,t.container=e("<div />").addClass(t.core.opt.css_shades).prependTo(this.core.container).hide(),t.elh=this.core.container.height(),t.elw=this.core.container.width(),t.shades={top:t.createShade(),right:t.createShade(),left:t.createShade(),bottom:t.createShade()},t.attached=!0)},destroy:function(){this.container.remove()},setColor:function(n,o){var i=this;if(n==i.color)return i;this.color=n;var r=t.supportsColorFade();return e.each(i.shades,function(e,t){i.fade&&!o&&r?t.animate({backgroundColor:n},{queue:!1,duration:i.fadeSpeed,easing:i.fadeEasing}):t.css("backgroundColor",n)}),i},setOpacity:function(t,n){var o=this;return t==o.opacity?o:(o.opacity=t,e.each(o.shades,function(e,i){!o.fade||n?i.css({opacity:t}):i.animate({opacity:t},{queue:!1,duration:o.fadeSpeed,easing:o.fadeEasing})}),o)},createShade:function(){return e("<div />").css({position:"absolute",backgroundColor:this.color,opacity:this.opacity}).appendTo(this.container)},refresh:function(e){var t=this.core,n=this.shades;this.setColor(e.bgColor?e.bgColor:this.core.opt.bgColor),this.setOpacity(e.bgOpacity?e.bgOpacity:this.core.opt.bgOpacity),this.elh=t.container.height(),this.elw=t.container.width(),n.right.css("height",this.elh+"px"),n.left.css("height",this.elh+"px")},filter:function(e,t,n){if(!n.active)return e;var o=this,i=o.shades;return i.top.css({left:Math.round(e.x)+"px",width:Math.round(e.w)+"px",height:Math.round(e.y)+"px"}),i.bottom.css({top:Math.round(e.y2)+"px",left:Math.round(e.x)+"px",width:Math.round(e.w)+"px",height:o.elh-Math.round(e.y2)+"px"}),i.right.css({left:Math.round(e.x2)+"px",width:o.elw-Math.round(e.x2)+"px"}),i.left.css({width:Math.round(e.x)+"px"}),o.visible||(o.container.show(),o.visible=!0),e}}),t.registerFilter("shader",h);var g=function(e){this.stage=e,this.core=e.core,this.cloneStagePosition()};g.prototype={cloneStagePosition:function(){var e=this.stage;this.angle=e.angle,this.scale=e.scale,this.offset=e.offset},getElement:function(){var t=this.stage;return e("<div />").css({position:"absolute",top:t.offset[0]+"px",left:t.offset[1]+"px",width:t.angle+"px",height:t.scale+"px"})},animate:function(e){var t=this;this.scale=this.stage.boundScale(this.scale),t.stage.triggerEvent("croprotstart"),t.getElement().animate({top:t.offset[0]+"px",left:t.offset[1]+"px",width:t.angle+"px",height:t.scale+"px"},{easing:t.core.opt.animEasing,duration:t.core.opt.animDuration,complete:function(){t.stage.triggerEvent("croprotend"),"function"==typeof e&&e.call(this)},progress:function(e){var n,o={},i=e.tweens;for(n=0;n<i.length;n++)o[i[n].prop]=i[n].now;t.stage.setAngle(o.width).setScale(o.height).setOffset(o.top,o.left).redraw()}})}},t.stage.Canvas.prototype.getAnimator=function(){return new g(this)},t.registerComponent("CanvasAnimator",g);var p=function(e){this.selection=e,this.core=e.core};p.prototype={getElement:function(){var t=this.selection.get();return e("<div />").css({position:"absolute",top:t.y+"px",left:t.x+"px",width:t.w+"px",height:t.h+"px"})},animate:function(e,t,n,o,i){var r=this;r.selection.allowResize(!1),r.getElement().animate({top:t+"px",left:e+"px",width:n+"px",height:o+"px"},{easing:r.core.opt.animEasing,duration:r.core.opt.animDuration,complete:function(){r.selection.allowResize(!0),i&&i.call(this)},progress:function(e){var t,n={},o=e.tweens;for(t=0;t<o.length;t++)n[o[t].prop]=o[t].now;var i={x:parseInt(n.left),y:parseInt(n.top),w:parseInt(n.width),h:parseInt(n.height)};i.x2=i.x+i.w,i.y2=i.y+i.h,r.selection.updateRaw(i,"se")}})}},t.registerComponent("Animator",p);var m=function(e,t,n){var o=this;o.x=e.pageX,o.y=e.pageY,o.selection=t,o.eventTarget=t.core.opt.dragEventTarget,o.orig=t.get(),t.callFilterFunction("refresh");var i=t.core.container.position();o.elx=i.left,o.ely=i.top,o.offsetx=0,o.offsety=0,o.ord=n,o.opposite=o.getOppositeCornerOffset(),o.initEvents(e)};m.prototype={getOppositeCornerOffset:function(){var e=this.orig,t=this.x-this.elx-e.x,n=this.y-this.ely-e.y;switch(this.ord){case"nw":case"w":return[e.w-t,e.h-n];case"sw":return[e.w-t,-n];case"se":case"s":case"e":return[-t,-n];case"ne":case"n":return[-t,e.h-n]}return[null,null]},initEvents:function(t){e(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())},dragEvent:function(e){this.offsetx=e.pageX-this.x,this.offsety=e.pageY-this.y,this.selection.updateRaw(this.getBox(),this.ord)},endDragEvent:function(e){var t=this.selection;t.core.container.removeClass("jcrop-dragging"),t.element.trigger("cropend",[t,t.core.unscale(t.get())]),t.focus()},createStopHandler:function(){var t=this;return function(n){return e(t.eventTarget).off(".jcrop"),t.endDragEvent(n),!1}},createDragHandler:function(){var e=this;return function(t){return e.dragEvent(t),!1}},update:function(e,t){this.offsetx=e-this.x,this.offsety=t-this.y},resultWrap:function(e){var t={x:Math.min(e[0],e[2]),y:Math.min(e[1],e[3]),x2:Math.max(e[0],e[2]),y2:Math.max(e[1],e[3])};return t.w=t.x2-t.x,t.h=t.y2-t.y,t},getBox:function(){var e=this,t=e.orig,n={x2:t.x+t.w,y2:t.y+t.h};switch(e.ord){case"n":return e.resultWrap([t.x,e.offsety+t.y,n.x2,n.y2]);case"s":return e.resultWrap([t.x,t.y,n.x2,e.offsety+n.y2]);case"e":return e.resultWrap([t.x,t.y,e.offsetx+n.x2,n.y2]);case"w":return e.resultWrap([t.x+e.offsetx,t.y,n.x2,n.y2]);case"sw":return e.resultWrap([e.offsetx+t.x,t.y,n.x2,e.offsety+n.y2]);case"se":return e.resultWrap([t.x,t.y,e.offsetx+n.x2,e.offsety+n.y2]);case"ne":return e.resultWrap([t.x,e.offsety+t.y,e.offsetx+n.x2,n.y2]);case"nw":return e.resultWrap([e.offsetx+t.x,e.offsety+t.y,n.x2,n.y2]);case"move":return n.nx=t.x+e.offsetx,n.ny=t.y+e.offsety,e.resultWrap([n.nx,n.ny,n.nx+t.w,n.ny+t.h])}}},t.registerComponent("DragState",m);var f=function(e){this.core=e};f.prototype={on:function(t,n){e(this).on(t,n)},off:function(t){e(this).off(t)},trigger:function(t){e(this).trigger(t)}},t.registerComponent("EventManager",f);var v=function(e,t,n){this.src=e,t||(t=new Image),this.element=t,this.callback=n,this.load()};e.extend(v,{attach:function(e,t){return new v(e.src,e,t)},prototype:{getDimensions:function(){var e=this.element;return e.naturalWidth?[e.naturalWidth,e.naturalHeight]:e.width?[e.width,e.height]:null},fireCallback:function(){this.element.onload=null,"function"==typeof this.callback&&this.callback.apply(this,this.getDimensions())},isLoaded:function(){return this.element.complete},load:function(){var e=this;e.element.src=e.src,e.isLoaded()?e.fireCallback():e.element.onload=function(t){e.fireCallback()}}}}),t.registerComponent("ImageLoader",v);var w=function(e){this.core=e,this.init()};e.extend(w,{support:function(){if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0},prototype:{init:function(){var t=e.JcropAnsel.component.DragState.prototype;t.touch||(this.initEvents(),this.shimDragState(),this.shimStageDrag(),t.touch=!0)},shimDragState:function(){var t=this;e.JcropAnsel.component.DragState.prototype.initEvents=function(n){"touch"==n.type.substr(0,5)?e(this.eventTarget).on("touchmove.jcrop.jcrop-touch",t.dragWrap(this.createDragHandler())).on("touchend.jcrop.jcrop-touch",this.createStopHandler()):e(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())}},shimStageDrag:function(){this.core.container.addClass("jcrop-touch").on("touchstart.jcrop.jcrop-stage",this.dragWrap(this.core.ui.manager.startDragHandler()))},dragWrap:function(e){return function(t){return t.preventDefault(),t.stopPropagation(),"touch"==t.type.substr(0,5)&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,e(t))}},initEvents:function(){var e=this.core;e.container.on("touchstart.jcrop.jcrop-touch","."+e.opt.css_drag,this.dragWrap(e.startDrag()))}}}),t.registerComponent("Touch",w);var y=function(e){this.core=e,this.init()};e.extend(y,{defaults:{eventName:"keydown.jcrop",passthru:[9],debug:!1},prototype:{init:function(){e.extend(this,y.defaults),this.enable()},disable:function(){this.core.container.off(this.eventName)},enable:function(){var t=this,n=t.core;n.container.on(t.eventName,function(o){var i=o.shiftKey?16:2;if(e.inArray(o.keyCode,t.passthru)>=0)return!0;switch(o.keyCode){case 37:n.nudge(-i,0);break;case 38:n.nudge(0,-i);break;case 39:n.nudge(i,0);break;case 40:n.nudge(0,i);break;case 46:case 8:return n.requestDelete(),!1;default:t.debug&&console.log("keycode: "+o.keyCode)}o.metaKey||o.ctrlKey||o.preventDefault()})}}}),t.registerComponent("Keyboard",y);var S=function(){};e.extend(S,{defaults:{minSize:[8,8],maxSize:[0,0],aspectRatio:0,edge:{n:0,s:0,e:0,w:0},bgColor:null,bgOpacity:null,last:null,state:null,active:!0,linked:!0,canDelete:!0,canDrag:!0,canResize:!0,canSelect:!0},prototype:{init:function(e){this.core=e,this.startup(),this.linked=this.core.opt.linked,this.attach(),this.setOptions(this.core.opt),e.container.trigger("cropcreate",[this])},attach:function(){},startup:function(){var t=this,n=t.core.opt;e.extend(t,S.defaults),t.filter=t.core.getDefaultFilters(),t.element=e("<div />").addClass(n.css_selection).data({selection:t}),t.frame=e("<button />").addClass(n.css_button).data("ord","move").attr("type","button"),t.element.append(t.frame).appendTo(t.core.container),t.core.opt.is_msie&&t.frame.css({opacity:0,backgroundColor:"white"}),t.insertElements(),t.frame.on("focus.jcrop",function(e){t.core.setSelection(t),t.element.trigger("cropfocus",t),t.element.addClass("jcrop-focus")}).on("blur.jcrop",function(e){t.element.removeClass("jcrop-focus"),t.element.trigger("cropblur",t)})},propagate:["canDelete","canDrag","canResize","canSelect","minSize","maxSize","aspectRatio","edge"],setOptions:function(e){return t.propagate(this.propagate,e,this),this.refresh(),this},refresh:function(){this.allowResize(),this.allowDrag(),this.allowSelect(),this.callFilterFunction("refresh"),this.updateRaw(this.get(),"se")},callFilterFunction:function(e,t){for(var n=0;n<this.filter.length;n++)this.filter[n][e]&&this.filter[n][e](this);return this},addFilter:function(e){e.core=this.core,this.hasFilter(e)||(this.filter.push(e),this.sortFilters(),e.init&&e.init(),this.refresh())},hasFilter:function(e){var t,n=this.filter;for(t=0;t<n.length;t++)if(n[t]===e)return!0},sortFilters:function(){this.filter.sort(function(e,t){return e.priority-t.priority})},clearFilters:function(){for(var e=this.filter,t=0;t<e.length;t++)e[t].destroy&&e[t].destroy();this.filter=[]},removeFilter:function(e){for(var t=this.filter,n=[],o=0;o<t.length;o++)t[o].tag&&t[o].tag==e||e===t[o]?t[o].destroy&&t[o].destroy():n.push(t[o]);this.filter=n},runFilters:function(e,t){for(var n=0;n<this.filter.length;n++)e=this.filter[n].filter(e,t,this);return e},endDrag:function(){this.state&&(e(document.body).off(".jcrop"),this.focus(),this.state=null)},startDrag:function(n,o){this.core;return o=o||e(n.target).data("ord"),this.focus(),("move"!=o||!this.element.hasClass(this.core.opt.css_nodrag))&&(this.state=new t.component.DragState(n,this,o),!1)},allowSelect:function(e){return void 0===e&&(e=this.canSelect),e&&this.canSelect?this.frame.attr("disabled",!1):this.frame.attr("disabled","disabled"),this},allowDrag:function(e){var t=this,n=t.core.opt;return null==e&&(e=t.canDrag),e&&t.canDrag?t.element.removeClass(n.css_nodrag):t.element.addClass(n.css_nodrag),this},allowResize:function(e){var t=this,n=t.core.opt;return null==e&&(e=t.canResize),e&&t.canResize?t.element.removeClass(n.css_noresize):t.element.addClass(n.css_noresize),this},remove:function(){this.element.trigger("cropremove",this),this.element.remove()},toBack:function(){this.active=!1,this.element.removeClass("jcrop-current jcrop-focus")},toFront:function(){this.active=!0,this.element.addClass("jcrop-current"),this.callFilterFunction("refresh"),this.refresh()},redraw:function(e){return this.moveTo(e.x,e.y),this.resize(e.w,e.h),this.last=e,this},update:function(e,t){return this.updateRaw(this.core.scale(e),t)},updateRaw:function(e,t){return e=this.runFilters(e,t),this.redraw(e),this.element.trigger("cropmove",[this,this.core.unscale(e)]),this},animateTo:function(e,n){var o=new t.component.Animator(this),i=this.core.scale(t.wrapFromXywh(e));o.animate(i.x,i.y,i.w,i.h,n)},center:function(e){var t=this.get(),n=this.core,o=n.container.width(),i=n.container.height(),r=[(o-t.w)/2,(i-t.h)/2,t.w,t.h];return this[e?"setSelect":"animateTo"](r)},createElement:function(t,n){return e("<div />").addClass(t+" ord-"+n).data("ord",n)},moveTo:function(e,t){this.element.css({top:t+"px",left:e+"px"})},blur:function(){return this.element.blur(),this},focus:function(){return this.core.setSelection(this),this.frame.focus(),this},resize:function(e,t){this.element.css({width:e+"px",height:t+"px"})},get:function(){var e=this.element,t=e.position(),n=e.width(),o=e.height(),i={x:t.left,y:t.top};return i.x2=i.x+n,i.y2=i.y+o,i.w=n,i.h=o,i},insertElements:function(){var e,t=this,n=(t.core,t.element),o=t.core.opt,i=o.borders,r=o.handles,a=o.dragbars;for(e=0;e<a.length;e++)n.append(t.createElement(o.css_dragbars,a[e]));for(e=0;e<r.length;e++)n.append(t.createElement(o.css_handles,r[e]));for(e=0;e<i.length;e++)n.append(t.createElement(o.css_borders,i[e]))}}}),t.registerComponent("Selection",S);var x=function(t,n){e.extend(this,x.defaults,n||{}),this.manager=t,this.core=t.core};x.defaults={offset:[-8,-8],active:!0,minsize:[20,20]},e.extend(x.prototype,{start:function(n){var o=this.core;if(o.opt.allowSelect){if(o.opt.multi&&o.opt.multiMax&&o.ui.multi.length>=o.opt.multiMax)return!1;var i=e(n.currentTarget).offset(),r=n.pageX-i.left+this.offset[0],a=n.pageY-i.top+this.offset[1],s=o.ui.multi;if(!o.opt.multi)if(o.opt.multiCleanup){for(var l=0;l<s.length;l++)s[l].remove();o.ui.multi=[]}else o.removeSelection(o.ui.selection);o.container.addClass("jcrop-dragging");var c=o.newSelection().updateRaw(t.wrapFromXywh([r,a,1,1]));return c.element.trigger("cropstart",[c,this.core.unscale(c.get())]),c.startDrag(n,"se")}},end:function(e,t){this.drag(e,t);var n=this.sel.get();this.core.container.removeClass("jcrop-dragging"),n.w<this.minsize[0]||n.h<this.minsize[1]?this.core.requestDelete():this.sel.focus()}}),t.registerComponent("StageDrag",x);var C=function(e){this.core=e,this.ui=e.ui,this.init()};e.extend(C.prototype,{init:function(){this.setupEvents(),this.dragger=new x(this)},tellConfigUpdate:function(e){for(var t=0,n=this.ui.multi,o=n.length;t<o;t++)n[t].setOptions&&(n[t].linked||this.core.opt.linkCurrent&&n[t]==this.ui.selection)&&n[t].setOptions(e)},startDragHandler:function(){var e=this;return function(t){if(!t.button||e.core.opt.is_ie_lt9)return e.dragger.start(t)}},removeEvents:function(){this.core.event.off(".jcrop-stage"),this.core.container.off(".jcrop-stage")},shimLegacyHandlers:function(t){var n,o=this.core;e.each(o.opt.legacyHandlers,function(e,i){e in t&&(n=t[e],o.container.off(".jcrop-"+e).on(i+".jcrop.jcrop-"+e,function(e,t,i){n.call(o,i)}),delete t[e])})},setupEvents:function(){var e=this,t=e.core;t.event.on("configupdate.jcrop-stage",function(n){e.shimLegacyHandlers(t.opt),e.tellConfigUpdate(t.opt),t.container.trigger("cropconfig",[t,t.opt])}),this.core.container.on("mousedown.jcrop.jcrop-stage",this.startDragHandler())}}),t.registerComponent("StageManager",C);var A=function(){};e.extend(A,{defaults:{selection:null,fading:!0,fadeDelay:1e3,fadeDuration:1e3,autoHide:!1,width:80,height:80,_hiding:null},prototype:{recopyCanvas:function(){var e=this.core.ui.stage,t=e.context;this.context.putImageData(t.getImageData(0,0,e.canvas.width,e.canvas.height),0,0)},init:function(t,n){var o=this;this.core=t,e.extend(this,A.defaults,n),o.initEvents(),o.refresh(),o.insertElements(),o.selection?(o.renderSelection(o.selection),o.selectionTarget=o.selection.element[0]):o.core.ui.selection&&o.renderSelection(o.core.ui.selection),o.core.ui.stage.canvas&&(o.context=o.preview[0].getContext("2d"),o.core.container.on("cropredraw",function(e){o.recopyCanvas(),o.refresh()}))},updateImage:function(t){return this.preview.remove(),this.preview=e(e.JcropAnsel.imageClone(t)),this.element.append(this.preview),this.refresh(),this},insertElements:function(){this.preview=e(e.JcropAnsel.imageClone(this.core.ui.stage.imgsrc)),this.element=e("<div />").addClass("jcrop-thumb").width(this.width).height(this.height).append(this.preview).appendTo(this.core.container)},resize:function(e,t){this.width=e,this.height=t,this.element.width(e).height(t),this.renderCoords(this.last)},refresh:function(){this.cw=this.core.opt.xscale*this.core.container.width(),this.ch=this.core.opt.yscale*this.core.container.height(),this.last&&this.renderCoords(this.last)},renderCoords:function(e){var t=this.width/e.w,n=this.height/e.h;return this.preview.css({width:Math.round(t*this.cw)+"px",height:Math.round(n*this.ch)+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(n*e.y)+"px"}),this.last=e,this},renderSelection:function(e){return this.renderCoords(e.core.unscale(e.get()))},selectionStart:function(e){this.renderSelection(e)},show:function(){this._hiding&&clearTimeout(this._hiding),this.fading?this.element.stop().animate({opacity:1},{duration:80,queue:!1}):this.element.stop().css({opacity:1})},hide:function(){var e=this;e.fading?e._hiding=setTimeout(function(){e._hiding=null,e.element.stop().animate({opacity:0},{duration:e.fadeDuration,queue:!1})},e.fadeDelay):e.element.hide()},initEvents:function(){var e=this;e.core.container.on("croprotstart croprotend cropimage cropstart cropmove cropend",function(t,n,o){if(e.selectionTarget&&e.selectionTarget!==t.target)return!1;switch(t.type){case"cropimage":e.updateImage(o);break;case"cropstart":e.selectionStart(n);case"croprotstart":e.show();break;case"cropend":e.renderCoords(o);case"croprotend":e.autoHide&&e.hide();break;case"cropmove":e.renderCoords(o)}})}}}),t.registerComponent("Thumbnailer",A);var F=function(){};F.prototype={init:function(t,n,o){n||(n=t.container),this.$btn=e(n),this.$targ=e(n),this.core=t,this.$btn.addClass("dialdrag").on("mousedown.dialdrag",this.mousedown()).data("dialdrag",this),e.isFunction(o)||(o=function(){}),this.callback=o,this.ondone=o},remove:function(){return this.$btn.removeClass("dialdrag").off(".dialdrag").data("dialdrag",null),this},setTarget:function(t){return this.$targ=e(t),this},getOffset:function(){var e=this.$targ,t=e.offset();return[t.left+e.width()/2,t.top+e.height()/2]},relMouse:function(e){var t=e.pageX-this.offset[0],n=e.pageY-this.offset[1];return[t,n,Math.atan2(n,t)*(180/Math.PI),Math.sqrt(Math.pow(t,2)+Math.pow(n,2))]},mousedown:function(){var t=this;function n(n){e(window).off(".dialdrag"),t.ondone.call(t,t.relMouse(n)),t.core.container.trigger("croprotend")}function o(e){t.callback.call(t,t.relMouse(e))}return function(i){t.offset=t.getOffset();var r=t.relMouse(i);return t.angleOffset=-t.core.ui.stage.angle+r[2],t.distOffset=r[3],t.dragOffset=[r[0],r[1]],t.core.container.trigger("croprotstart"),e(window).on("mousemove.dialdrag",o).on("mouseup.dialdrag",n),t.callback.call(t,t.relMouse(i)),!1}}},t.registerComponent("DialDrag",F),t.defaults={edge:{n:0,s:0,e:0,w:0},setSelect:null,linked:!0,linkCurrent:!0,canDelete:!0,canSelect:!0,canDrag:!0,canResize:!0,eventManagerComponent:t.component.EventManager,keyboardComponent:t.component.Keyboard,dragstateComponent:t.component.DragState,stagemanagerComponent:t.component.StageManager,animatorComponent:t.component.Animator,selectionComponent:t.component.Selection,stageConstructor:t.stageConstructor,allowSelect:!0,multi:!1,multiMax:!1,multiCleanup:!0,animation:!0,animEasing:"swing",animDuration:400,fading:!0,fadeDuration:300,fadeEasing:"swing",bgColor:"black",bgOpacity:.5,applyFilters:["constrain","extent","backoff","ratio","shader","round"],borders:["e","w","s","n"],handles:["n","s","e","w","sw","ne","nw","se"],dragbars:["n","e","w","s"],dragEventTarget:window,xscale:1,yscale:1,boxWidth:null,boxHeight:null,css_nodrag:"jcrop-nodrag",css_drag:"jcrop-drag",css_container:"jcrop-active",css_shades:"jcrop-shades",css_selection:"jcrop-selection",css_borders:"jcrop-border",css_handles:"jcrop-handle jcrop-drag",css_button:"jcrop-box jcrop-drag",css_noresize:"jcrop-noresize",css_dragbars:"jcrop-dragbar jcrop-drag",legacyHandlers:{onChange:"cropmove",onSelect:"cropend"}},e.extend(t.prototype,{init:function(){this.event=new this.opt.eventManagerComponent(this),this.ui.keyboard=new this.opt.keyboardComponent(this),this.ui.manager=new this.opt.stagemanagerComponent(this),this.applyFilters(),e.JcropAnsel.supportsTouch&&new e.JcropAnsel.component.Touch(this),this.initEvents()},applySizeConstraints:function(){var n=this.opt,o=this.opt.imgsrc;if(o){var i=o.naturalWidth||o.width,r=o.naturalHeight||o.height,a=n.boxWidth||i,s=n.boxHeight||r;if(o&&(i>a||r>s)){var l=t.getLargestBox(i/r,a,s);e(o).width(l[0]).height(l[1]),this.resizeContainer(l[0],l[1]),this.opt.xscale=i/l[0],this.opt.yscale=r/l[1]}}if(this.opt.trueSize){var c=this.opt.trueSize[0],d=this.opt.trueSize[1],u=this.getContainerSize();this.opt.xscale=c/u[0],this.opt.yscale=d/u[1]}},initComponent:function(e){if(t.component[e]){var n=Array.prototype.slice.call(arguments),o=new t.component[e];return n.shift(),n.unshift(this),o.init.apply(o,n),o}},setOptions:function(t,n){return e.isPlainObject(t)||(t={}),e.extend(this.opt,t),this.opt.setSelect&&(this.ui.multi.length||this.newSelection(),this.setSelect(this.opt.setSelect),this.opt.setSelect=null),this.event.trigger("configupdate"),this},destroy:function(){this.opt.imgsrc?(this.container.before(this.opt.imgsrc),this.container.remove(),e(this.opt.imgsrc).removeData("JcropAnsel").show()):this.container.remove()},applyFilters:function(){for(var t,n=0,o=this.opt.applyFilters,i=o.length;n<i;n++)e.JcropAnsel.filter[o[n]]&&(t=new e.JcropAnsel.filter[o[n]]),t.core=this,t.init&&t.init(),this.filter[o[n]]=t},getDefaultFilters:function(){for(var e=[],t=0,n=this.opt.applyFilters,o=n.length;t<o;t++)this.filter.hasOwnProperty(n[t])&&e.push(this.filter[n[t]]);return e.sort(function(e,t){return e.priority-t.priority}),e},setSelection:function(e){for(var t=this.ui.multi,n=[],o=0;o<t.length;o++)t[o]!==e&&n.push(t[o]),t[o].toBack();return n.unshift(e),this.ui.multi=n,this.ui.selection=e,e.toFront(),e},getSelection:function(e){return this.ui.selection.get()},newSelection:function(e){return e||(e=new this.opt.selectionComponent),e.init(this),this.setSelection(e),e},hasSelection:function(e){for(var t=0;t<this.ui.multi;t++)if(e===this.ui.multi[t])return!0},removeSelection:function(e){for(var t=[],n=this.ui.multi,o=0;o<n.length;o++)e!==n[o]?t.push(n[o]):n[o].remove();return this.ui.multi=t},addFilter:function(e){for(var t=0,n=this.ui.multi,o=n.length;t<o;t++)n[t].addFilter(e);return this},removeFilter:function(e){for(var t=0,n=this.ui.multi,o=n.length;t<o;t++)n[t].removeFilter(e);return this},blur:function(){return this.ui.selection.blur(),this},focus:function(){return this.ui.selection.focus(),this},initEvents:function(){this.container.on("selectstart",function(e){return!1}).on("mousedown","."+this.opt.css_drag,this.startDrag())},maxSelect:function(){this.setSelect([0,0,this.elw,this.elh])},nudge:function(e,t){var n=this.ui.selection,o=n.get();o.x+=e,o.x2+=e,o.y+=t,o.y2+=t,o.x<0?(o.x2=o.w,o.x=0):o.x2>this.elw&&(o.x2=this.elw,o.x=o.x2-o.w),o.y<0?(o.y2=o.h,o.y=0):o.y2>this.elh&&(o.y2=this.elh,o.y=o.y2-o.h),n.element.trigger("cropstart",[n,this.unscale(o)]),n.updateRaw(o,"move"),n.element.trigger("cropend",[n,this.unscale(o)])},refresh:function(){for(var e=0,t=this.ui.multi,n=t.length;e<n;e++)t[e].refresh()},blurAll:function(){for(var e=this.ui.multi,t=0;t<e.length;t++)e[t]!==sel&&n.push(e[t]),e[t].toBack()},scale:function(e){var t=this.opt.xscale,n=this.opt.yscale;return{x:e.x/t,y:e.y/n,x2:e.x2/t,y2:e.y2/n,w:e.w/t,h:e.h/n}},unscale:function(e){var t=this.opt.xscale,n=this.opt.yscale;return{x:e.x*t,y:e.y*n,x2:e.x2*t,y2:e.y2*n,w:e.w*t,h:e.h*n}},requestDelete:function(){if(this.ui.multi.length>1&&this.ui.selection.canDelete)return this.deleteSelection()},deleteSelection:function(){this.ui.selection&&(this.removeSelection(this.ui.selection),this.ui.multi.length&&this.ui.multi[0].focus(),this.ui.selection.refresh())},animateTo:function(e){return this.ui.selection&&this.ui.selection.animateTo(e),this},setSelect:function(e){return this.ui.selection&&this.ui.selection.update(t.wrapFromXywh(e)),this},startDrag:function(){var t=this;return function(n){var o=e(n.target),i=o.closest("."+t.opt.css_selection).data("selection"),r=o.data("ord");return t.container.trigger("cropstart",[i,t.unscale(i.get())]),i.startDrag(n,r),!1}},getContainerSize:function(){return[this.container.width(),this.container.height()]},resizeContainer:function(e,t){this.container.width(e).height(t),this.refresh()},setImage:function(t,n){var o=this,i=o.opt.imgsrc;if(!i)return!1;new e.JcropAnsel.component.ImageLoader(t,null,function(r,a){o.resizeContainer(r,a),i.src=t,e(i).width(r).height(a),o.applySizeConstraints(),o.refresh(),o.container.trigger("cropimage",[o,i]),"function"==typeof n&&n.call(o,r,a)})},update:function(e){this.ui.selection&&this.ui.selection.update(e)}}),e.fn.JcropAnsel=function(t,n){t=t||{};var o=this.eq(0).data("JcropAnsel"),i=Array.prototype.slice.call(arguments);return"api"==t?o:o&&"string"==typeof t?!!o[t]&&(i.shift(),o[t].apply(o,i),o):void this.each(function(){var o=e(this),i=o.data("JcropAnsel");return i?i.setOptions(t):(t.stageConstructor||(t.stageConstructor=e.JcropAnsel.stageConstructor),t.stageConstructor(this,t,function(t,i){var r=i.setSelect;r&&delete i.setSelect;var a=e.JcropAnsel.attach(t.element,i);"function"==typeof t.attach&&t.attach(a),o.data("JcropAnsel",a),r&&(a.newSelection(),a.setSelect(r)),"function"==typeof n&&n.call(a)})),this})};var T,b=function(e,t,n){var o,i,r,a={},s=t.documentElement,l="modernizr",c=t.createElement(l),d=c.style,u={}.toString,h=" -webkit- -moz- -o- -ms- ".split(" "),g="Webkit Moz O ms",p=g.split(" "),m=g.toLowerCase().split(" "),f="http://www.w3.org/2000/svg",v={},w=[],y=w.slice,S=function(e,n,o,i){var r,a,c,d,u=t.createElement("div"),h=t.body,g=h||t.createElement("body");if(parseInt(o,10))for(;o--;)(c=t.createElement("div")).id=i?i[o]:l+(o+1),u.appendChild(c);return r=["&#173;",'<style id="s',l,'">',e,"</style>"].join(""),u.id=l,(h?u:g).innerHTML+=r,g.appendChild(u),h||(g.style.background="",g.style.overflow="hidden",d=s.style.overflow,s.style.overflow="hidden",s.appendChild(g)),a=n(u,e),h?u.parentNode.removeChild(u):(g.parentNode.removeChild(g),s.style.overflow=d),!!a},x=(r={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},function(e,o){o=o||t.createElement(r[e]||"div");var i=(e="on"+e)in o;return i||(o.setAttribute||(o=t.createElement("div")),o.setAttribute&&o.removeAttribute&&(o.setAttribute(e,""),i=F(o[e],"function"),F(o[e],"undefined")||(o[e]=n),o.removeAttribute(e))),o=null,i}),C={}.hasOwnProperty;function A(e){d.cssText=e}function F(e,t){return typeof e===t}function T(e,t){for(var o in e){var i=e[o];if(!~(""+i).indexOf("-")&&d[i]!==n)return"pfx"!=t||i}return!1}function b(e,t,o){var i=e.charAt(0).toUpperCase()+e.slice(1),r=(e+" "+p.join(i+" ")+i).split(" ");return F(t,"string")||F(t,"undefined")?T(r,t):function(e,t,o){for(var i in e){var r=t[e[i]];if(r!==n)return!1===o?e[i]:F(r,"function")?r.bind(o||t):r}return!1}(r=(e+" "+m.join(i+" ")+i).split(" "),t,o)}for(var I in i=F(C,"undefined")||F(C.call,"undefined")?function(e,t){return t in e&&F(e.constructor.prototype[t],"undefined")}:function(e,t){return C.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=y.call(arguments,1),o=function(){if(this instanceof o){var i=function(){};i.prototype=t.prototype;var r=new i,a=t.apply(r,n.concat(y.call(arguments)));return Object(a)===a?a:r}return t.apply(e,n.concat(y.call(arguments)))};return o}),v.canvas=function(){var e=t.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},v.canvastext=function(){return!(!a.canvas||!F(t.createElement("canvas").getContext("2d").fillText,"function"))},v.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:S(["@media (",h.join("touch-enabled),("),l,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=9===e.offsetTop}),n},v.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},v.csstransforms=function(){return!!b("transform")},v.svg=function(){return!!t.createElementNS&&!!t.createElementNS(f,"svg").createSVGRect},v.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==f},v.svgclippaths=function(){return!!t.createElementNS&&/SVGClipPath/.test(u.call(t.createElementNS(f,"clipPath")))},v)i(v,I)&&(o=I.toLowerCase(),a[o]=v[I](),w.push((a[o]?"":"no-")+o));return a.addTest=function(e,t){if("object"==typeof e)for(var o in e)i(e,o)&&a.addTest(o,e[o]);else{if(e=e.toLowerCase(),a[e]!==n)return a;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(s.className+=" "+(t?"":"no-")+e),a[e]=t}return a},A(""),c=null,a._version="2.7.1",a._prefixes=h,a._domPrefixes=m,a._cssomPrefixes=p,a.hasEvent=x,a.testProp=function(e){return T([e])},a.testAllProps=b,a.testStyles=S,a}(window,window.document);(T=new Image).onerror=function(){b.addTest("datauri",function(){return!1})},T.onload=function(){b.addTest("datauri",function(){return 1==T.width&&1==T.height})},T.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",e.JcropAnsel=t,e.JcropAnsel.supportsCanvas=b.canvas,e.JcropAnsel.supportsCanvasText=b.canvastext,e.JcropAnsel.supportsDragAndDrop=b.draganddrop,e.JcropAnsel.supportsDataURI=b.datauri,e.JcropAnsel.supportsSVG=b.svg,e.JcropAnsel.supportsInlineSVG=b.inlinesvg,e.JcropAnsel.supportsSVGClipPaths=b.svgclippaths,e.JcropAnsel.supportsCSSTransforms=b.csstransforms,e.JcropAnsel.supportsTouch=b.touch}(jQuery),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},runFabController(window[window.FABNAMESPACE]),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";var t=[],n=function(e){var n;return"object"!=typeof e&&(e={}),(n=function(n){var o,i=this;for(var r in i.guid=(o=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})()+o()+"-"+o()+"-"+o()+"-"+o()+"-"+o()+o()+o(),t.push(i.guid),i.properties={},i.propertyTypes=e,i.changeEvents={},i.propertyTypes)i.propertyTypes.hasOwnProperty(r)&&(i.changeEvents[r]={});for(var a in n)n.hasOwnProperty(a)&&void 0!==i.propertyTypes[a]&&(i.properties[a]=n[a])}).prototype={get:function(e){var t=this;return t.properties[e]?"int"===t.propertyTypes[e]?parseInt(t.properties[e]):"float"===t.propertyTypes[e]?parseFloat(t.properties[e]):"string"===t.propertyTypes[e]?String(t.properties[e]):"bool"===t.propertyTypes[e]?!0===t.properties[e]:"array"===t.propertyTypes[e]?t.properties[e].constructor===Array?t.properties[e]:[]:"object"===t.propertyTypes[e]?t.properties[e].constructor===Object?t.properties[e]:{}:null:"int"===t.propertyTypes[e]||"float"===t.propertyTypes[e]?0:"string"===t.propertyTypes[e]?"":"bool"!==t.propertyTypes[e]&&("array"===t.propertyTypes[e]?[]:"object"===t.propertyTypes[e]?{}:null)},set:function(e,t){var n,o=this,i=!1,r=o.properties[e];if("int"===o.propertyTypes[e]?(o.properties[e]=parseInt(t),i=!0):"float"===o.propertyTypes[e]?(o.properties[e]=parseFloat(t),i=!0):"string"===o.propertyTypes[e]?(o.properties[e]=String(t),i=!0):"bool"===o.propertyTypes[e]?(o.properties[e]=!0===t||"true"===t||"yes"===t||"y"===t,i=!0):"array"===o.propertyTypes[e]?t.constructor===Array&&(o.properties[e]=t,i=!0):"object"===o.propertyTypes[e]&&t.constructor===Object&&(o.properties[e]=t,i=!0),i&&r!==o.properties[e]&&void 0!==o.changeEvents[e])for(var a in n=[o.properties[e],r],o.changeEvents[e])o.changeEvents[e][a].forEach(function(e){e.apply(e,n)})},onChange:function(e,t){var n=this,o=e.split(".");void 0!==n.propertyTypes[o[0]]&&(void 0===o[1]?(void 0===n.changeEvents[o[0]].noNameSpace&&(n.changeEvents[o[0]].noNameSpace=[]),n.changeEvents[o[0]].noNameSpace.push(t)):(void 0===n.changeEvents[o[0]][o[1]]&&(n.changeEvents[o[0]][o[1]]=[]),n.changeEvents[o[0]][o[1]].push(t)))},offChange:function(e){var t=e.split(".");void 0===t[1]?this.changeEvents[t[0]]={}:delete this.changeEvents[t[0]][t[1]]}},n};e.model={make:function(){return n.apply(n,arguments)},validateGuid:function(e){return t.indexOf(e)>-1}}}(window[window.FABNAMESPACE]),window.FABNAMESPACE=window.FABNAMESPACE||"FAB",window[window.FABNAMESPACE]=window.window[window.FABNAMESPACE]||{},function(e){"use strict";window[window.FABNAMESPACE].uuid={make:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}}(),window.ANSEL=window.ANSEL||{},runCraftFileChooser(window.ANSEL),window.ANSEL=window.ANSEL||{},runField(window.ANSEL),window.ANSEL=window.ANSEL||{},runFieldDropUploader(window.ANSEL),window.ANSEL=window.ANSEL||{},runImage(window.ANSEL),window.ANSEL=window.ANSEL||{},runImageCrop(window.ANSEL),window.ANSEL=window.ANSEL||{},runImageProcessor(window.ANSEL),window.ANSEL=window.ANSEL||{},runMaxTracker(window.ANSEL),window.ANSEL=window.ANSEL||{},runMinTracker(window.ANSEL),window.ANSEL=window.ANSEL||{},runNotification(window.ANSEL),window.ANSEL=window.ANSEL||{},runNotifications(window.ANSEL),window.ANSEL=window.ANSEL||{},runMain(window.ANSEL);
//# sourceMappingURL=script.min.js.map